const Ve=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerpolicy&&(r.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?r.credentials="include":l.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}};Ve();function Z(){}function Me(t){return t()}function Ie(){return Object.create(null)}function X(t){t.forEach(Me)}function Qe(t){return typeof t=="function"}function Je(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Ze(t){return Object.keys(t).length===0}function i(t,e){t.appendChild(e)}function E(t,e,n){t.insertBefore(e,n||null)}function y(t){t.parentNode.removeChild(t)}function Ye(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function S(t){return document.createTextNode(t)}function C(){return S(" ")}function he(){return S("")}function G(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function d(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function $e(t){return Array.from(t.childNodes)}function z(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function Ce(t,e){t.value=e==null?"":e}function V(t,e,n,o){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}let ce;function ie(t){ce=t}function je(){if(!ce)throw new Error("Function called outside component initialization");return ce}function Ge(t){je().$$.on_mount.push(t)}function Ke(t){je().$$.on_destroy.push(t)}const se=[],ye=[],_e=[],we=[],et=Promise.resolve();let Te=!1;function tt(){Te||(Te=!0,et.then(qe))}function Ee(t){_e.push(t)}const ke=new Set;let de=0;function qe(){const t=ce;do{for(;de<se.length;){const e=se[de];de++,ie(e),nt(e.$$)}for(ie(null),se.length=0,de=0;ye.length;)ye.pop()();for(let e=0;e<_e.length;e+=1){const n=_e[e];ke.has(n)||(ke.add(n),n())}_e.length=0}while(se.length);for(;we.length;)we.pop()();Te=!1,ke.clear(),ie(t)}function nt(t){if(t.fragment!==null){t.update(),X(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ee)}}const me=new Set;let Q;function ot(){Q={r:0,c:[],p:Q}}function lt(){Q.r||X(Q.c),Q=Q.p}function be(t,e){t&&t.i&&(me.delete(t),t.i(e))}function Se(t,e,n,o){if(t&&t.o){if(me.has(t))return;me.add(t),Q.c.push(()=>{me.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}function rt(t){t&&t.c()}function xe(t,e,n,o){const{fragment:l,on_mount:r,on_destroy:s,after_update:b}=t.$$;l&&l.m(e,n),o||Ee(()=>{const O=r.map(Me).filter(Qe);s?s.push(...O):X(O),t.$$.on_mount=[]}),b.forEach(Ee)}function Xe(t,e){const n=t.$$;n.fragment!==null&&(X(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function st(t,e){t.$$.dirty[0]===-1&&(se.push(t),tt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ze(t,e,n,o,l,r,s,b=[-1]){const O=ce;ie(t);const u=t.$$={fragment:null,ctx:null,props:r,update:Z,not_equal:l,bound:Ie(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(O?O.$$.context:[])),callbacks:Ie(),dirty:b,skip_bound:!1,root:e.target||O.$$.root};s&&s(u.root);let N=!1;if(u.ctx=n?n(t,e.props||{},(_,w,...g)=>{const T=g.length?g[0]:w;return u.ctx&&l(u.ctx[_],u.ctx[_]=T)&&(!u.skip_bound&&u.bound[_]&&u.bound[_](T),N&&st(t,_)),w}):[],u.update(),N=!0,X(u.before_update),u.fragment=o?o(u.ctx):!1,e.target){if(e.hydrate){const _=$e(e.target);u.fragment&&u.fragment.l(_),_.forEach(y)}else u.fragment&&u.fragment.c();e.intro&&be(t.$$.fragment),xe(t,e.target,e.anchor,e.customElement),qe()}ie(O)}class He{$destroy(){Xe(this,1),this.$destroy=Z}$on(e,n){const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const l=o.indexOf(n);l!==-1&&o.splice(l,1)}}$set(e){this.$$set&&!Ze(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function it(t){let e,n,o,l;return{c(){e=p("div"),n=S(`Connecting\r
		`),o=p("tt"),l=S(t[1])},m(r,s){E(r,e,s),i(e,n),i(e,o),i(o,l)},p(r,s){s&2&&z(l,r[1])},d(r){r&&y(e)}}}function ct(t){let e,n;return{c(){e=p("div"),n=S(t[0])},m(o,l){E(o,e,l),i(e,n)},p(o,l){l&1&&z(n,o[0])},d(o){o&&y(e)}}}function ut(t){let e;function n(r,s){return r[0]?ct:it}let o=n(t),l=o(t);return{c(){l.c(),e=he()},m(r,s){l.m(r,s),E(r,e,s)},p(r,[s]){o===(o=n(r))&&l?l.p(r,s):(l.d(1),l=o(r),l&&(l.c(),l.m(e.parentNode,e)))},i:Z,o:Z,d(r){l.d(r),r&&y(e)}}}let ft=null;function at(t,e,n){let{connectionError:o}=e,l="|",r=0;return Ge(()=>{setInterval(()=>{const s="|/-\\";r=(r+1)%s.length,n(1,l=s[r])},100)}),Ke(()=>{clearInterval(ft)}),t.$$set=s=>{"connectionError"in s&&n(0,o=s.connectionError)},[o,l]}class dt extends He{constructor(e){super(),ze(this,e,at,ut,Je,{connectionError:0})}}var _t={1e3:"TW_ERROR_WRITING_TO_SOCKET",1001:"TW_SOCKET_INIT_ERROR",1002:"TW_INVALID_SSL_CERT",1003:"TW_SOCKET_NOT_FOUND",1004:"TW_HOST_NOT_FOUND",1005:"TW_ERROR_CREATING_SSL_CTX",1006:"TW_ERROR_CONNECTING_TO_PROXY",1007:"TW_TIMEOUT_READING_FROM_SOCKET",1008:"TW_ERROR_READING_RESPONSE",1009:"TW_INVALID_PROXY_CREDENTIALS",1010:"TW_UNSUPPORTED_PROXY_AUTH_TYPE"};function Re(t,e,n){const o=t.slice();return o[37]=e[n],o[41]=n,o}function Le(t,e,n){const o=t.slice();return o[37]=e[n],o}function Ae(t){let e,n,o=new Date(t[11]).toLocaleTimeString()+"",l;return{c(){e=p("div"),n=S("You can't submit new episodes until "),l=S(o),V(e,"margin-top","4px"),d(e,"class","svelte-v88xr9")},m(r,s){E(r,e,s),i(e,n),i(e,l)},p(r,s){s[0]&2048&&o!==(o=new Date(r[11]).toLocaleTimeString()+"")&&z(l,o)},d(r){r&&y(e)}}}function De(t){let e,n,o=new Date(t[12]).toLocaleTimeString()+"",l;return{c(){e=p("div"),n=S("You can't book until "),l=S(o),V(e,"margin-top","4px"),d(e,"class","svelte-v88xr9")},m(r,s){E(r,e,s),i(e,n),i(e,l)},p(r,s){s[0]&4096&&o!==(o=new Date(r[12]).toLocaleTimeString()+"")&&z(l,o)},d(r){r&&y(e)}}}function mt(t){let e,n=t[3],o=[];for(let l=0;l<n.length;l+=1)o[l]=We(Re(t,n,l));return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=he()},m(l,r){for(let s=0;s<o.length;s+=1)o[s].m(l,r);E(l,e,r)},p(l,r){if(r[0]&1572872){n=l[3];let s;for(s=0;s<n.length;s+=1){const b=Re(l,n,s);o[s]?o[s].p(b,r):(o[s]=We(b),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(l){Ye(o,l),l&&y(e)}}}function pt(t){let e,n=t[3],o=[];for(let l=0;l<n.length;l+=1)o[l]=Be(Le(t,n,l));return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=he()},m(l,r){for(let s=0;s<o.length;s+=1)o[s].m(l,r);E(l,e,r)},p(l,r){if(r[0]&8){n=l[3];let s;for(s=0;s<n.length;s+=1){const b=Le(l,n,s);o[s]?o[s].p(b,r):(o[s]=Be(b),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(l){Ye(o,l),l&&y(e)}}}function We(t){let e,n,o,l,r,s,b,O,u,N;function _(){return t[26](t[41])}function w(...g){return t[27](t[41],...g)}return{c(){e=p("div"),n=p("button"),n.textContent="x",o=C(),l=p("button"),l.textContent="*",r=C(),s=p("textarea"),O=C(),d(n,"class","svelte-v88xr9"),d(l,"class","svelte-v88xr9"),s.value=b=t[37],d(s,"class","svelte-v88xr9"),d(e,"class","admin-episode svelte-v88xr9")},m(g,T){E(g,e,T),i(e,n),i(e,o),i(e,l),i(e,r),i(e,s),i(e,O),u||(N=[G(n,"click",_),G(l,"click",w),G(s,"input",t[28])],u=!0)},p(g,T){t=g,T[0]&8&&b!==(b=t[37])&&(s.value=b)},d(g){g&&y(e),u=!1,X(N)}}}function Be(t){let e,n=t[37]+"",o;return{c(){e=p("cite"),o=S(n),d(e,"class","svelte-v88xr9")},m(l,r){E(l,e,r),i(e,o)},p(l,r){r[0]&8&&n!==(n=l[37]+"")&&z(o,n)},d(l){l&&y(e)}}}function Fe(t){let e;return{c(){e=p("div"),e.textContent="Submitted string is likely gibberish.",d(e,"class","svelte-v88xr9")},m(n,o){E(n,e,o)},d(n){n&&y(e)}}}function bt(t){let e,n;return e=new dt({props:{connectionError:t[9]}}),{c(){rt(e.$$.fragment)},m(o,l){xe(e,o,l),n=!0},p(o,l){const r={};l[0]&512&&(r.connectionError=o[9]),e.$set(r)},i(o){n||(be(e.$$.fragment,o),n=!0)},o(o){Se(e.$$.fragment,o),n=!1},d(o){Xe(e,o)}}}function ht(t){let e,n=t[0].length+"",o,l,r,s,b,O,u,N,_,w,g,T,h,I,M,v=t[13]&&Pe(t);return{c(){e=p("div"),o=S(n),l=S(" / "),r=S(pe),s=C(),b=p("button"),O=S("Submit!"),N=C(),_=p("button"),w=S("Book"),T=C(),v&&v.c(),h=he(),d(e,"id","counter"),V(e,"color",t[15]),V(e,"animation-name",t[14]),d(e,"class","svelte-v88xr9"),d(b,"type","submit"),b.disabled=u=t[4]&&!t[5]||!!t[12],d(b,"class","svelte-v88xr9"),_.disabled=g=t[4]||!!t[12],d(_,"class","svelte-v88xr9")},m(f,k){E(f,e,k),i(e,o),i(e,l),i(e,r),E(f,s,k),E(f,b,k),i(b,O),E(f,N,k),E(f,_,k),i(_,w),E(f,T,k),v&&v.m(f,k),E(f,h,k),I||(M=[G(b,"click",t[17]),G(_,"click",t[30])],I=!0)},p(f,k){k[0]&1&&n!==(n=f[0].length+"")&&z(o,n),k[0]&32768&&V(e,"color",f[15]),k[0]&16384&&V(e,"animation-name",f[14]),k[0]&4144&&u!==(u=f[4]&&!f[5]||!!f[12])&&(b.disabled=u),k[0]&4112&&g!==(g=f[4]||!!f[12])&&(_.disabled=g),f[13]?v?v.p(f,k):(v=Pe(f),v.c(),v.m(h.parentNode,h)):v&&(v.d(1),v=null)},i:Z,o:Z,d(f){f&&y(e),f&&y(s),f&&y(b),f&&y(N),f&&y(_),f&&y(T),v&&v.d(f),f&&y(h),I=!1,X(M)}}}function Pe(t){let e,n,o;return{c(){e=p("button"),e.textContent="Force submit",d(e,"id","force-submit-btn"),d(e,"type","submit"),d(e,"class","svelte-v88xr9")},m(l,r){E(l,e,r),n||(o=G(e,"click",t[21]),n=!0)},p:Z,d(l){l&&y(e),n=!1,o()}}}function Ue(t){let e,n,o=t[31](t[6])+"",l;return{c(){e=p("div"),n=S("Booked for: "),l=S(o),V(e,"float","right"),d(e,"class","svelte-v88xr9")},m(r,s){E(r,e,s),i(e,n),i(e,l)},p(r,s){s[0]&64&&o!==(o=r[31](r[6])+"")&&z(l,o)},d(r){r&&y(e)}}}function gt(t){let e,n,o,l,r=t[10]/1e3+"",s,b,O,u,N,_,w,g,T,h,I,M,v,f,k,$,ue,L,A,ne,Y,ee,R,D,H,fe,oe,J,W,P,le,K,re,ae,a=t[11]&&Ae(t),c=t[12]&&De(t);function q(m,F){return m[13]?mt:pt}let te=q(t),j=te(t),U=t[7]&&Fe();const Oe=[ht,bt],x=[];function Ne(m,F){return m[8]?0:1}W=Ne(t),P=x[W]=Oe[W](t);let B=t[4]&&Ue(t);return{c(){e=p("main"),n=p("dialog"),o=p("p"),l=S("Booking allows you to prevent other users from submitting their episodes for a short period of time. ("),s=S(r),b=S(" seconds)"),O=C(),u=p("center"),N=p("button"),N.textContent="Book!",_=C(),w=p("span"),w.textContent="\xA0",g=C(),T=p("button"),T.textContent="Cancel",h=C(),I=p("center"),M=p("h1"),M.textContent="Storytelling experiment",v=C(),f=p("p"),f.textContent="TODO: add description",k=C(),$=p("br"),ue=C(),L=p("blockquote"),A=p("div"),a&&a.c(),ne=C(),c&&c.c(),Y=C(),j.c(),ee=C(),R=p("div"),D=p("textarea"),fe=C(),U&&U.c(),oe=C(),J=p("div"),P.c(),le=C(),B&&B.c(),d(o,"class","svelte-v88xr9"),d(N,"class","svelte-v88xr9"),d(w,"class","svelte-v88xr9"),d(T,"class","svelte-v88xr9"),d(u,"class","svelte-v88xr9"),n.open=t[2],d(n,"class","svelte-v88xr9"),d(M,"class","svelte-v88xr9"),d(f,"class","svelte-v88xr9"),d($,"class","svelte-v88xr9"),d(A,"class","svelte-v88xr9"),D.disabled=H=!t[8]&&!t[0].length,d(D,"placeholder","Your piece of the story!"),d(D,"type","text"),d(D,"class","svelte-v88xr9"),d(J,"id","submit-region"),d(J,"class","svelte-v88xr9"),d(R,"class","svelte-v88xr9"),d(L,"class","svelte-v88xr9"),d(I,"class","svelte-v88xr9"),d(e,"class","svelte-v88xr9")},m(m,F){E(m,e,F),i(e,n),i(n,o),i(o,l),i(o,s),i(o,b),i(n,O),i(n,u),i(u,N),i(u,_),i(u,w),i(u,g),i(u,T),i(e,h),i(e,I),i(I,M),i(I,v),i(I,f),i(I,k),i(I,$),i(I,ue),i(I,L),i(L,A),a&&a.m(A,null),i(A,ne),c&&c.m(A,null),i(L,Y),j.m(L,null),i(L,ee),i(L,R),i(R,D),Ce(D,t[0]),i(R,fe),U&&U.m(R,null),i(R,oe),i(R,J),x[W].m(J,null),i(J,le),B&&B.m(J,null),t[32](I),K=!0,re||(ae=[G(N,"click",t[18]),G(T,"click",t[25]),G(D,"input",t[29]),G(D,"input",t[16])],re=!0)},p(m,F){(!K||F[0]&1024)&&r!==(r=m[10]/1e3+"")&&z(s,r),(!K||F[0]&4)&&(n.open=m[2]),m[11]?a?a.p(m,F):(a=Ae(m),a.c(),a.m(A,ne)):a&&(a.d(1),a=null),m[12]?c?c.p(m,F):(c=De(m),c.c(),c.m(A,null)):c&&(c.d(1),c=null),te===(te=q(m))&&j?j.p(m,F):(j.d(1),j=te(m),j&&(j.c(),j.m(L,ee))),(!K||F[0]&257&&H!==(H=!m[8]&&!m[0].length))&&(D.disabled=H),F[0]&1&&Ce(D,m[0]),m[7]?U||(U=Fe(),U.c(),U.m(R,oe)):U&&(U.d(1),U=null);let ge=W;W=Ne(m),W===ge?x[W].p(m,F):(ot(),Se(x[ge],1,1,()=>{x[ge]=null}),lt(),P=x[W],P?P.p(m,F):(P=x[W]=Oe[W](m),P.c()),be(P,1),P.m(J,le)),m[4]?B?B.p(m,F):(B=Ue(m),B.c(),B.m(J,null)):B&&(B.d(1),B=null)},i(m){K||(be(P),K=!0)},o(m){Se(P),K=!1},d(m){m&&y(e),a&&a.d(),c&&c.d(),j.d(),U&&U.d(),x[W].d(),B&&B.d(),t[32](null),re=!1,X(ae)}}}const kt="wss://api.jiftoo.dev/story",pe=140,ve=150;function vt(t,e,n){let o,l,r="",s=-1;const b=a=>{const c=a.target.value.replaceAll(/[^A-Za-z0-9.,!?":\- ]/g,"");if(r.length>=pe&&s===-1&&(s=r.split(" ").length),r.length<pe&&(s=-1),s===-1)n(0,r=c);else if(c.split(" ").length>=s){const q=c.split(" ").slice(0,s).join(" ");n(0,r=q.substr(0,ve))}};let O=[],u=!1,N=!1,_=null,w=null,g=localStorage.getItem("st-bookid"),T=!1,h=null,I=!1,M=null,v=-1,f=null,k=null;const $=()=>{n(22,h=new WebSocket(kt)),h.addEventListener("message",a=>{const c=JSON.parse(a.data);switch(c.type){case"update":c.data.bookDuration&&n(10,v=c.data.bookDuration),n(3,O=c.data.episodes),n(4,u=c.isBooked),n(5,N=c.data.bookedForMe),n(6,_=c.data.bookedFor),clearInterval(w),_>0&&(w=setInterval(()=>{n(6,_-=1e3)},1e3)),c.data.timeouts&&(n(11,f=c.data.timeouts.submit),n(12,k=c.data.timeouts.book));break;case"submitSuccess":n(0,r=""),n(11,f=c.data.submit),n(12,k=c.data.book);break;case"bookSuccess":n(4,u=!0),n(5,N=!0),g=c.data.isBooked,n(12,k=c.data.timeout),localStorage.setItem("st-bookid",g);break;case"booked":n(4,u=!0),n(6,_=c.data.bookedFor),localStorage.setItem("st-booked-for",_.toString()),w=setInterval(()=>{n(6,_-=1e3)},1e3);break;case"unbooked":n(4,u=!1),g=null,n(6,_=0),clearInterval(w),localStorage.setItem("st-booked-for",_.toString()),localStorage.setItem("st-bookid","false");break;case"error":n(7,T=c.data==="gibberish");break;case"bookTimeQuery":n(10,v=c.data);break;case"adminAttempt":c.data===!0?(alert("admin access granted"),n(13,ee=!0)):alert("admin access denied");break}}),h.addEventListener("open",()=>{h.send(JSON.stringify({type:"get",bookId:g})),n(8,I=!0),n(9,M=null)}),h.addEventListener("close",a=>{var c;setTimeout($,2500),n(8,I=!1),n(9,M=`Error: ${(c=_t[a.code])!=null?c:a.code}`)})};Ge($),Ke(()=>{h==null||h.close(),n(22,h=null),clearInterval(w)});const ue=()=>{n(7,T=!1),h.send(JSON.stringify({type:"submit",bookId:g,data:r}))};let L,A=!1;const ne=()=>{n(2,A=!1),h.send(JSON.stringify({type:"book",bookId:g}))};let Y=!1,ee=!1,R=null;const D=a=>{h.send(JSON.stringify({type:"deleteLine",data:a,pwd:R}))},H=(a,c)=>{const q=c.currentTarget;q.classList.add("used"),setTimeout(()=>{q.classList.remove("used"),q.innerText="*"},1e3),q.innerText="\u2714";const te=c.currentTarget.parentElement.querySelector("textarea").value;h.send(JSON.stringify({type:"replaceLine",data:{i:a,line:te},pwd:R}))},fe=()=>{h.send(JSON.stringify({type:"forceSubmit",data:r,pwd:R}))},oe=()=>n(2,A=!1),J=a=>D(a),W=(a,c)=>H(a,c),P=a=>a.currentTarget.value=a.currentTarget.value.substr(0,ve);function le(){r=this.value,n(0,r),n(23,Y),n(22,h),n(24,R)}const K=()=>n(2,A=!0),re=a=>`${Math.floor(a/1e3/60)}  minutes ${Math.floor(a/1e3%60)} seconds`;function ae(a){ye[a?"unshift":"push"](()=>{L=a,n(1,L),n(2,A),n(23,Y),n(0,r),n(22,h),n(24,R)})}return t.$$.update=()=>{t.$$.dirty[0]&29360129&&(n(23,Y=r==='"""veeryseecreet"!""'),Y&&(n(0,r=""),n(24,R=prompt("Enter password")),h.send(JSON.stringify({type:"admin",data:R})),n(23,Y=!1))),t.$$.dirty[0]&1&&n(15,o=r.length===ve?"red":"unset"),t.$$.dirty[0]&1&&n(14,l=r.length>pe?"vibrate":""),t.$$.dirty[0]&8388614&&L&&n(1,L.style.pointerEvents=A||Y?"none":null,L)},[r,L,A,O,u,N,_,T,I,M,v,f,k,ee,l,o,b,ue,ne,D,H,fe,h,Y,R,oe,J,W,P,le,K,re,ae]}class yt extends He{constructor(e){super(),ze(this,e,vt,gt,Je,{},null,[-1,-1])}}new yt({target:document.body});
