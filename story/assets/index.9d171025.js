const xe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerpolicy&&(r.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?r.credentials="include":l.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}};xe();function Q(){}function We(t){return t()}function Te(){return Object.create(null)}function X(t){t.forEach(We)}function qe(t){return typeof t=="function"}function Be(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Xe(t){return Object.keys(t).length===0}function i(t,e){t.appendChild(e)}function S(t,e,n){t.insertBefore(e,n||null)}function y(t){t.parentNode.removeChild(t)}function Pe(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function m(t){return document.createElement(t)}function I(t){return document.createTextNode(t)}function L(){return I(" ")}function pe(){return I("")}function j(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function _(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function ze(t){return Array.from(t.childNodes)}function z(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function Ee(t,e){t.value=e==null?"":e}function ne(t,e,n,o){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}let re;function le(t){re=t}function Fe(){if(!re)throw new Error("Function called outside component initialization");return re}function Ue(t){Fe().$$.on_mount.push(t)}function Me(t){Fe().$$.on_destroy.push(t)}const oe=[],ge=[],fe=[],Se=[],He=Promise.resolve();let ke=!1;function Ve(){ke||(ke=!0,He.then(Je))}function ve(t){fe.push(t)}const be=new Set;let ue=0;function Je(){const t=re;do{for(;ue<oe.length;){const e=oe[ue];ue++,le(e),Qe(e.$$)}for(le(null),oe.length=0,ue=0;ge.length;)ge.pop()();for(let e=0;e<fe.length;e+=1){const n=fe[e];be.has(n)||(be.add(n),n())}fe.length=0}while(oe.length);for(;Se.length;)Se.pop()();ke=!1,be.clear(),le(t)}function Qe(t){if(t.fragment!==null){t.update(),X(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ve)}}const ae=new Set;let V;function Ze(){V={r:0,c:[],p:V}}function $e(){V.r||X(V.c),V=V.p}function _e(t,e){t&&t.i&&(ae.delete(t),t.i(e))}function ye(t,e,n,o){if(t&&t.o){if(ae.has(t))return;ae.add(t),V.c.push(()=>{ae.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}function et(t){t&&t.c()}function Ye(t,e,n,o){const{fragment:l,on_mount:r,on_destroy:s,after_update:g}=t.$$;l&&l.m(e,n),o||ve(()=>{const T=r.map(We).filter(qe);s?s.push(...T):X(T),t.$$.on_mount=[]}),g.forEach(ve)}function Ge(t,e){const n=t.$$;n.fragment!==null&&(X(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function tt(t,e){t.$$.dirty[0]===-1&&(oe.push(t),Ve(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ke(t,e,n,o,l,r,s,g=[-1]){const T=re;le(t);const u=t.$$={fragment:null,ctx:null,props:r,update:Q,not_equal:l,bound:Te(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(T?T.$$.context:[])),callbacks:Te(),dirty:g,skip_bound:!1,root:e.target||T.$$.root};s&&s(u.root);let A=!1;if(u.ctx=n?n(t,e.props||{},(b,C,...p)=>{const w=p.length?p[0]:C;return u.ctx&&l(u.ctx[b],u.ctx[b]=w)&&(!u.skip_bound&&u.bound[b]&&u.bound[b](w),A&&tt(t,b)),C}):[],u.update(),A=!0,X(u.before_update),u.fragment=o?o(u.ctx):!1,e.target){if(e.hydrate){const b=ze(e.target);u.fragment&&u.fragment.l(b),b.forEach(y)}else u.fragment&&u.fragment.c();e.intro&&_e(t.$$.fragment),Ye(t,e.target,e.anchor,e.customElement),Je()}le(T)}class je{$destroy(){Ge(this,1),this.$destroy=Q}$on(e,n){const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const l=o.indexOf(n);l!==-1&&o.splice(l,1)}}$set(e){this.$$set&&!Xe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function nt(t){let e,n,o,l;return{c(){e=m("div"),n=I(`Connecting\r
		`),o=m("tt"),l=I(t[1])},m(r,s){S(r,e,s),i(e,n),i(e,o),i(o,l)},p(r,s){s&2&&z(l,r[1])},d(r){r&&y(e)}}}function ot(t){let e,n;return{c(){e=m("div"),n=I(t[0])},m(o,l){S(o,e,l),i(e,n)},p(o,l){l&1&&z(n,o[0])},d(o){o&&y(e)}}}function lt(t){let e;function n(r,s){return r[0]?ot:nt}let o=n(t),l=o(t);return{c(){l.c(),e=pe()},m(r,s){l.m(r,s),S(r,e,s)},p(r,[s]){o===(o=n(r))&&l?l.p(r,s):(l.d(1),l=o(r),l&&(l.c(),l.m(e.parentNode,e)))},i:Q,o:Q,d(r){l.d(r),r&&y(e)}}}let rt=null;function st(t,e,n){let{connectionError:o}=e,l="|",r=0;return Ue(()=>{setInterval(()=>{const s="|/-\\";r=(r+1)%s.length,n(1,l=s[r])},100)}),Me(()=>{clearInterval(rt)}),t.$$set=s=>{"connectionError"in s&&n(0,o=s.connectionError)},[o,l]}class it extends je{constructor(e){super(),Ke(this,e,st,lt,Be,{connectionError:0})}}var ct={1e3:"TW_ERROR_WRITING_TO_SOCKET",1001:"TW_SOCKET_INIT_ERROR",1002:"TW_INVALID_SSL_CERT",1003:"TW_SOCKET_NOT_FOUND",1004:"TW_HOST_NOT_FOUND",1005:"TW_ERROR_CREATING_SSL_CTX",1006:"TW_ERROR_CONNECTING_TO_PROXY",1007:"TW_TIMEOUT_READING_FROM_SOCKET",1008:"TW_ERROR_READING_RESPONSE",1009:"TW_INVALID_PROXY_CREDENTIALS",1010:"TW_UNSUPPORTED_PROXY_AUTH_TYPE"};function Oe(t,e,n){const o=t.slice();return o[37]=e[n],o[41]=n,o}function Ne(t,e,n){const o=t.slice();return o[37]=e[n],o}function ut(t){let e,n=t[3],o=[];for(let l=0;l<n.length;l+=1)o[l]=Ie(Oe(t,n,l));return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=pe()},m(l,r){for(let s=0;s<o.length;s+=1)o[s].m(l,r);S(l,e,r)},p(l,r){if(r[0]&1572872){n=l[3];let s;for(s=0;s<n.length;s+=1){const g=Oe(l,n,s);o[s]?o[s].p(g,r):(o[s]=Ie(g),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(l){Pe(o,l),l&&y(e)}}}function ft(t){let e,n=t[3],o=[];for(let l=0;l<n.length;l+=1)o[l]=Ce(Ne(t,n,l));return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=pe()},m(l,r){for(let s=0;s<o.length;s+=1)o[s].m(l,r);S(l,e,r)},p(l,r){if(r[0]&8){n=l[3];let s;for(s=0;s<n.length;s+=1){const g=Ne(l,n,s);o[s]?o[s].p(g,r):(o[s]=Ce(g),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(l){Pe(o,l),l&&y(e)}}}function Ie(t){let e,n,o,l,r,s,g,T,u,A;function b(){return t[26](t[41])}function C(...p){return t[27](t[41],...p)}return{c(){e=m("div"),n=m("button"),n.textContent="x",o=L(),l=m("button"),l.textContent="*",r=L(),s=m("textarea"),T=L(),_(n,"class","svelte-v88xr9"),_(l,"class","svelte-v88xr9"),s.value=g=t[37],_(s,"class","svelte-v88xr9"),_(e,"class","admin-episode svelte-v88xr9")},m(p,w){S(p,e,w),i(e,n),i(e,o),i(e,l),i(e,r),i(e,s),i(e,T),u||(A=[j(n,"click",b),j(l,"click",C),j(s,"input",t[28])],u=!0)},p(p,w){t=p,w[0]&8&&g!==(g=t[37])&&(s.value=g)},d(p){p&&y(e),u=!1,X(A)}}}function Ce(t){let e,n=t[37]+"",o;return{c(){e=m("cite"),o=I(n),_(e,"class","svelte-v88xr9")},m(l,r){S(l,e,r),i(e,o)},p(l,r){r[0]&8&&n!==(n=l[37]+"")&&z(o,n)},d(l){l&&y(e)}}}function we(t){let e;return{c(){e=m("div"),e.textContent="Submitted string is likely gibberish.",_(e,"class","svelte-v88xr9")},m(n,o){S(n,e,o)},d(n){n&&y(e)}}}function at(t){let e,n;return e=new it({props:{connectionError:t[9]}}),{c(){et(e.$$.fragment)},m(o,l){Ye(e,o,l),n=!0},p(o,l){const r={};l[0]&512&&(r.connectionError=o[9]),e.$set(r)},i(o){n||(_e(e.$$.fragment,o),n=!0)},o(o){ye(e.$$.fragment,o),n=!1},d(o){Ge(e,o)}}}function dt(t){let e,n=t[0].length+"",o,l,r,s,g,T,u,A,b,C,p,w,k,O,F,x,v=t[11]&&Re(t),E=t[12]&&Le(t),N=t[13]&&Ae(t);return{c(){e=m("div"),o=I(n),l=I(" / "),r=I(de),s=L(),v&&v.c(),g=L(),E&&E.c(),T=L(),u=m("button"),A=I("Submit!"),C=L(),p=m("button"),w=I("Book"),k=L(),N&&N.c(),O=pe(),_(e,"id","counter"),ne(e,"color",t[15]),ne(e,"animation-name",t[14]),_(e,"class","svelte-v88xr9"),_(u,"type","submit"),u.disabled=b=t[4]&&!t[5],_(u,"class","svelte-v88xr9"),p.disabled=t[4],_(p,"class","svelte-v88xr9")},m(c,a){S(c,e,a),i(e,o),i(e,l),i(e,r),S(c,s,a),v&&v.m(c,a),S(c,g,a),E&&E.m(c,a),S(c,T,a),S(c,u,a),i(u,A),S(c,C,a),S(c,p,a),i(p,w),S(c,k,a),N&&N.m(c,a),S(c,O,a),F||(x=[j(u,"click",t[17]),j(p,"click",t[30])],F=!0)},p(c,a){a[0]&1&&n!==(n=c[0].length+"")&&z(o,n),a[0]&32768&&ne(e,"color",c[15]),a[0]&16384&&ne(e,"animation-name",c[14]),c[11]?v?v.p(c,a):(v=Re(c),v.c(),v.m(g.parentNode,g)):v&&(v.d(1),v=null),c[12]?E?E.p(c,a):(E=Le(c),E.c(),E.m(T.parentNode,T)):E&&(E.d(1),E=null),a[0]&48&&b!==(b=c[4]&&!c[5])&&(u.disabled=b),a[0]&16&&(p.disabled=c[4]),c[13]?N?N.p(c,a):(N=Ae(c),N.c(),N.m(O.parentNode,O)):N&&(N.d(1),N=null)},i:Q,o:Q,d(c){c&&y(e),c&&y(s),v&&v.d(c),c&&y(g),E&&E.d(c),c&&y(T),c&&y(u),c&&y(C),c&&y(p),c&&y(k),N&&N.d(c),c&&y(O),F=!1,X(x)}}}function Re(t){let e,n,o=new Date(t[11]).toLocaleTimeString()+"",l;return{c(){e=m("div"),n=I("You can't submit new episodes until "),l=I(o),_(e,"class","svelte-v88xr9")},m(r,s){S(r,e,s),i(e,n),i(e,l)},p(r,s){s[0]&2048&&o!==(o=new Date(r[11]).toLocaleTimeString()+"")&&z(l,o)},d(r){r&&y(e)}}}function Le(t){let e,n,o=new Date(t[12]).toLocaleTimeString()+"",l;return{c(){e=m("div"),n=I("You can't book until "),l=I(o),_(e,"class","svelte-v88xr9")},m(r,s){S(r,e,s),i(e,n),i(e,l)},p(r,s){s[0]&4096&&o!==(o=new Date(r[12]).toLocaleTimeString()+"")&&z(l,o)},d(r){r&&y(e)}}}function Ae(t){let e,n,o;return{c(){e=m("button"),e.textContent="Force submit",_(e,"id","force-submit-btn"),_(e,"type","submit"),_(e,"class","svelte-v88xr9")},m(l,r){S(l,e,r),n||(o=j(e,"click",t[21]),n=!0)},p:Q,d(l){l&&y(e),n=!1,o()}}}function De(t){let e,n,o=t[31](t[6])+"",l;return{c(){e=m("div"),n=I("Booked for: "),l=I(o),ne(e,"float","right"),_(e,"class","svelte-v88xr9")},m(r,s){S(r,e,s),i(e,n),i(e,l)},p(r,s){s[0]&64&&o!==(o=r[31](r[6])+"")&&z(l,o)},d(r){r&&y(e)}}}function _t(t){let e,n,o,l,r=t[10]/1e3+"",s,g,T,u,A,b,C,p,w,k,O,F,x,v,E,N,c,a,K,Y,R,H,G,Z,U,W,P,ee,q,te,se;function ie(h,J){return h[13]?ut:ft}let $=ie(t),M=$(t),f=t[7]&&we();const d=[dt,at],D=[];function ce(h,J){return h[8]?0:1}W=ce(t),P=D[W]=d[W](t);let B=t[4]&&De(t);return{c(){e=m("main"),n=m("dialog"),o=m("p"),l=I("Booking allows you to prevent other users from submitting their episodes for a short period of time. ("),s=I(r),g=I(" seconds)"),T=L(),u=m("center"),A=m("button"),A.textContent="Book!",b=L(),C=m("span"),C.textContent="\xA0",p=L(),w=m("button"),w.textContent="Cancel",k=L(),O=m("center"),F=m("h1"),F.textContent="Storytelling experiment",x=L(),v=m("p"),v.textContent="TODO: add description",E=L(),N=m("br"),c=L(),a=m("blockquote"),M.c(),K=L(),Y=m("div"),R=m("textarea"),G=L(),f&&f.c(),Z=L(),U=m("div"),P.c(),ee=L(),B&&B.c(),_(o,"class","svelte-v88xr9"),_(A,"class","svelte-v88xr9"),_(C,"class","svelte-v88xr9"),_(w,"class","svelte-v88xr9"),_(u,"class","svelte-v88xr9"),n.open=t[2],_(n,"class","svelte-v88xr9"),_(F,"class","svelte-v88xr9"),_(v,"class","svelte-v88xr9"),_(N,"class","svelte-v88xr9"),R.disabled=H=!t[8]&&!t[0].length,_(R,"placeholder","Your piece of the story!"),_(R,"type","text"),_(R,"class","svelte-v88xr9"),_(U,"id","submit-region"),_(U,"class","svelte-v88xr9"),_(Y,"class","svelte-v88xr9"),_(a,"class","svelte-v88xr9"),_(O,"class","svelte-v88xr9"),_(e,"class","svelte-v88xr9")},m(h,J){S(h,e,J),i(e,n),i(n,o),i(o,l),i(o,s),i(o,g),i(n,T),i(n,u),i(u,A),i(u,b),i(u,C),i(u,p),i(u,w),i(e,k),i(e,O),i(O,F),i(O,x),i(O,v),i(O,E),i(O,N),i(O,c),i(O,a),M.m(a,null),i(a,K),i(a,Y),i(Y,R),Ee(R,t[0]),i(Y,G),f&&f.m(Y,null),i(Y,Z),i(Y,U),D[W].m(U,null),i(U,ee),B&&B.m(U,null),t[32](O),q=!0,te||(se=[j(A,"click",t[18]),j(w,"click",t[25]),j(R,"input",t[29]),j(R,"input",t[16])],te=!0)},p(h,J){(!q||J[0]&1024)&&r!==(r=h[10]/1e3+"")&&z(s,r),(!q||J[0]&4)&&(n.open=h[2]),$===($=ie(h))&&M?M.p(h,J):(M.d(1),M=$(h),M&&(M.c(),M.m(a,K))),(!q||J[0]&257&&H!==(H=!h[8]&&!h[0].length))&&(R.disabled=H),J[0]&1&&Ee(R,h[0]),h[7]?f||(f=we(),f.c(),f.m(Y,Z)):f&&(f.d(1),f=null);let me=W;W=ce(h),W===me?D[W].p(h,J):(Ze(),ye(D[me],1,1,()=>{D[me]=null}),$e(),P=D[W],P?P.p(h,J):(P=D[W]=d[W](h),P.c()),_e(P,1),P.m(U,ee)),h[4]?B?B.p(h,J):(B=De(h),B.c(),B.m(U,null)):B&&(B.d(1),B=null)},i(h){q||(_e(P),q=!0)},o(h){ye(P),q=!1},d(h){h&&y(e),M.d(),f&&f.d(),D[W].d(),B&&B.d(),t[32](null),te=!1,X(se)}}}const pt="ws://217.15.202.178:8013/story",de=140,he=150;function mt(t,e,n){let o,l,r="",s=-1;const g=f=>{const d=f.target.value.replaceAll(/[^A-Za-z0-9.,!?":\- ]/g,"");if(r.length>=de&&s===-1&&(s=r.split(" ").length),r.length<de&&(s=-1),s===-1)n(0,r=d);else if(d.split(" ").length>=s){const D=d.split(" ").slice(0,s).join(" ");n(0,r=D.substr(0,he))}};let T=[],u=!1,A=!1,b=null,C=null,p=localStorage.getItem("st-bookid");console.log("bookId",p);let w=!1,k=null,O=!1,F=null,x=-1,v=null,E=null;const N=()=>{n(22,k=new WebSocket(pt)),k.addEventListener("message",f=>{const d=JSON.parse(f.data);switch(d.type){case"update":d.data.bookDuration&&n(10,x=d.data.bookDuration),n(3,T=d.data.episodes),n(4,u=d.isBooked),n(5,A=d.data.bookedForMe),n(6,b=d.data.bookedFor),clearInterval(C),b>0&&(C=setInterval(()=>{n(6,b-=1e3)},1e3)),d.data.timeouts&&(n(11,v=d.data.timeouts.submit),n(12,E=d.data.timeouts.book),console.log(d.data.timeouts));break;case"submitSuccess":n(0,r=""),n(11,v=d.data.submit),n(12,E=d.data.book);break;case"bookSuccess":n(4,u=!0),n(5,A=!0),p=d.data.isBooked,n(12,E=d.data.timeout),localStorage.setItem("st-bookid",p),console.log("you booked",p);break;case"booked":n(4,u=!0),n(6,b=d.data.bookedFor),localStorage.setItem("st-booked-for",b.toString()),console.log("someone booked for",b),C=setInterval(()=>{n(6,b-=1e3)},1e3);break;case"unbooked":n(4,u=!1),p=null,n(6,b=0),clearInterval(C),localStorage.setItem("st-booked-for",b.toString()),localStorage.setItem("st-bookid","false"),console.log("unbooked");break;case"error":n(7,w=d.data==="gibberish"),console.error(d.data);break;case"bookTimeQuery":n(10,x=d.data);break;case"adminAttempt":d.data===!0?(alert("admin access granted"),n(13,H=!0)):alert("admin access denied");break}}),k.addEventListener("open",()=>{k.send(JSON.stringify({type:"get",bookId:p})),n(8,O=!0),n(9,F=null)}),k.addEventListener("close",f=>{var d;setTimeout(N,2500),n(8,O=!1),n(9,F=`Error: ${(d=ct[f.code])!=null?d:f.code}`)})};Ue(N),Me(()=>{k==null||k.close(),n(22,k=null),clearInterval(C)});const c=()=>{n(7,w=!1),k.send(JSON.stringify({type:"submit",bookId:p,data:r}))};let a,K=!1;const Y=()=>{n(2,K=!1),k.send(JSON.stringify({type:"book",bookId:p}))};let R=!1,H=!1,G=null;const Z=f=>{console.log("removed",f),k.send(JSON.stringify({type:"deleteLine",data:f,pwd:G}))},U=(f,d)=>{const D=d.currentTarget;D.classList.add("used"),setTimeout(()=>{D.classList.remove("used"),D.innerText="*"},1e3),D.innerText="\u2714",console.log("edited",f);const ce=d.currentTarget.parentElement.querySelector("textarea").value;k.send(JSON.stringify({type:"replaceLine",data:{i:f,line:ce},pwd:G}))},W=()=>{k.send(JSON.stringify({type:"forceSubmit",data:r,pwd:G}))},P=()=>n(2,K=!1),ee=f=>Z(f),q=(f,d)=>U(f,d),te=f=>f.currentTarget.value=f.currentTarget.value.substr(0,he);function se(){r=this.value,n(0,r),n(23,R),n(22,k),n(24,G)}const ie=()=>n(2,K=!0),$=f=>`${Math.floor(f/1e3/60)}  minutes ${Math.floor(f/1e3%60)} seconds`;function M(f){ge[f?"unshift":"push"](()=>{a=f,n(1,a),n(2,K),n(23,R),n(0,r),n(22,k),n(24,G)})}return t.$$.update=()=>{t.$$.dirty[0]&29360129&&(n(23,R=r==='"""veeryseecreet"!""'),R&&(n(0,r=""),n(24,G=prompt("Enter password")),k.send(JSON.stringify({type:"admin",data:G})),n(23,R=!1))),t.$$.dirty[0]&1&&n(15,o=r.length===he?"red":"unset"),t.$$.dirty[0]&1&&n(14,l=r.length>de?"vibrate":""),t.$$.dirty[0]&8388614&&a&&n(1,a.style.pointerEvents=K||R?"none":null,a)},[r,a,K,T,u,A,b,w,O,F,x,v,E,H,l,o,g,c,Y,Z,U,W,k,R,G,P,ee,q,te,se,ie,$,M]}class bt extends je{constructor(e){super(),Ke(this,e,mt,_t,Be,{},null,[-1,-1])}}new bt({target:document.body});
