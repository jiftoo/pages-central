var ut=Object.defineProperty;var ct=(e,n,r)=>n in e?ut(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r;var Le=(e,n,r)=>(ct(e,typeof n!="symbol"?n+"":n,r),r);import{k as ke,l as s,S as Je,h as _e,i as $,c as he,a as J,F as dt,p as ft,t as re,C as ge,M,J as ht}from"./index-CQiPjXso.js";import{Q as K,T as A}from"./TextField-C-lKYZ4W.js";import{D as $e}from"./DropdownSelect-xhVFJVYr.js";import{u as xe,B as qe,r as mt,d as x,C as Ge,A as Ke,E as Qe,G as Ze,H as we,J as Be,K as gt,O as pt,Q as yt,T as bt}from"./DocumentFlow-BPOldJNx.js";import{C as He}from"./Checkbox-DX-q6fZB.js";import{calculateReturnDate as vt}from"./SrokVozvrata-CSoFGWTq.js";import{R as Xe}from"./RadioGroup-mQMpjHja.js";const G={"demo-name":"_demo-name_1ihfr_1","raschet-buttons":"_raschet-buttons_1ihfr_10","calculator-table":"_calculator-table_1ihfr_35","rounded-fix":"_rounded-fix_1ihfr_71","checkpoint-glow":"_checkpoint-glow_1ihfr_189","checkpoint-start":"_checkpoint-start_1ihfr_192","checkpoint-deadline":"_checkpoint-deadline_1ihfr_195","checkpoint-payment-decrease":"_checkpoint-payment-decrease_1ihfr_198","checkpoint-payment-increase":"_checkpoint-payment-increase_1ihfr_201","checkpoint-change":"_checkpoint-change_1ihfr_204","checkpoint-change-term":"_checkpoint-change-term_1ihfr_207","checkpoint-leapYear":"_checkpoint-leapYear_1ihfr_210","checkpoint-charge":"_checkpoint-charge_1ihfr_213","checkpoint-synthetic":"_checkpoint-synthetic_1ihfr_216","checkpoint-idk":"_checkpoint-idk_1ihfr_219"};function Dt(e,n,r){return Math.max(n,Math.min(e,r))}function _t(e){return typeof e=="number"&&isNaN(e)&&e!==e}function We(e){var Ye,Ee,Ne;let{startDate:n,endDate:r,haltDate:l,feeLimited:i,events:u,court:d,overrideFee:p,returnMoreThanLoan:h}=e;//! If percent.amount is 0, then it is affected by rate changes, but
//! if percent.amount is "0", then it is actually just zero percent/period
const g={...e.percent},m={...e.fee};g.amount=g.amount||g.amount==0?+g.amount.toString().replace(",","."):null,m.amount=m.amount||m.amount==0?+m.amount.toString().replace(",","."):null,p&&(m.amount=0,m.type="percent",m.period="year");const w=(Ye=e.total)!=null&&Ye.replace?+e.total.replace(",","."):+e.total,S=(Ee=e.proofTotal)!=null&&Ee.replace?+e.proofTotal.replace(",","."):e.proofTotal;console.debug("totals",w,S,Math.min(w,S));const Y=Math.min(w,S);if([Y,n,r,l,Object.values(g),Object.values(m)].some(t=>t===null||t===""))return console.info("Not enouugh data to calculate",Object.fromEntries(Object.entries({total:Y,startDate:n,endDate:r,haltDate:l,percent:g,fee:m}).filter(([t,a])=>a===null||a===""))),null;const U=["debt","to","percentPeriod","feePeriod","percentData","feeData","percentDisabled","feeDisabled","formula","calculatedPercent","calculatedFee"];let c=null;const Q=(t,a)=>{try{const o=t.indexOf(t.slice(a+1).find(y=>!y.info.oneDay));return console.assert(o>0,"next multiple day checkpoint index is <= 0",o,a),t[o]}catch(o){throw console.debug(t,a,t.slice(a+1)),o}},C=class{constructor(t,a,o={}){this.from=a,this.terminated=o.terminated??!1,this.enrichment=0,this.info={...o,type:t},this.info.oneDay=P.isOneDayEvent(this.info.type),U.forEach(y=>this[y]=null)}daysInYear(){const t=this.from.getFullYear();return t%400===0||t%100!==0&&t%4===0?366:365}startSpecial({total:t,calculatorData:a,nextCheckpoint:o,returnMore:y}){this.debt=t,this.to=o.info.type==="deadline"?P.addDays(o.from,-1):o.from,this.percentPeriod=P.dateDiff(a.percent.period,this.from,this.to),this.feePeriod=P.dateDiff(a.fee.period,this.from,this.to);const D=P.lastRateChange(W,this.from),F=g.amount===0&&!y.is;console.assert(!!D,"lastRateChange is falsey",D),console.assert(!!g.amount||g.amount===0,"percent.amount is falsey",g.amount),this.percentData={amount:F?D:g.amount,type:g.type,period:g.period,rateAffected:F};const H=m.amount===0;this.feeData={amount:H?D:m.amount,type:m.type,period:m.period,rateAffected:H,one300th:m.one300th},this.percentDisabled=a.percent.disabled?k.user:k.no,this.feeDisabled=a.fee.disabled?k.user:k.yes}firstStage({previousCheckpoint:t,nextCheckpoint:a,index:o}){this.from<n||(this.debt=t.debt,this.enrichment=t.enrichment,this.info.type==="deadline"&&t.percentData.period==="all"?this.to=r:a.info.type==="payment"?a.info.amountIncrease-a.info.amountDecrease>0?this.to=this.info.oneDay?null:P.addDays(a.from,-1):this.to=this.info.oneDay?null:a.from:a.info.type==="halt"?this.to=this.info.oneDay?null:a.from:this.to=this.info.oneDay?null:P.addDays(a.from,-1),this.percentPeriod=t.percentPeriod,this.feePeriod=t.feePeriod,this.percentData={...t.percentData},this.feeData={...t.feeData},this.percentDisabled=t.percentDisabled,this.feeDisabled=t.feeDisabled,t.info.type==="deadline"&&(t.percentData.period==="all"&&(this.percentDisabled=k.user),t.feeData.period==="all"&&(this.feeDisabled=k.user)),(t.terminated||this.terminated)&&(this.terminated=!0,t.terminated||(this.debt+=te.percent(o)),this.percentDisabled=k.user,this.feeData.period="year",this.feeData.type="percent",this.info.type==="rate"?this.feeData.amount=this.info.rate:this.feeData.amount=P.lastRateChange(W,this.from)))}secondStage({previousCheckpoint:t}){this.info.type==="change"&&(this.info.percentAmount!==null&&(this.percentData.type=this.info.percentType,this.percentData.period=this.info.percentPeriod,this.percentData.amount=this.info.percentAmount,this.percentData.rateAffected=!1),this.info.feeAmount!==null&&(this.feeData.type=this.info.feeType,this.feeData.period=this.info.feePeriod,this.feeData.amount=this.info.feeAmount,this.feeData.rateAffected=!1),this.terminated||(this.percentDisabled=this.info.percentDisabled?k.user:k.no),this.feeDisabled=this.feeDisabled===k.user?k.user:this.info.feeDisabled?k.yes:k.no),this.info.oneDay?this.percentPeriod=this.feePeriod=null:(this.percentPeriod=P.dateDiff(this.percentData.period,this.from,this.to),this.info.type==="synthetic"&&console.log("period",this.percentData.period,this.from,this.to,this.percentPeriod),this.feePeriod=P.dateDiff(this.feeData.period,this.from,this.to));const a=()=>{this.percentData&&this.percentData.period==="all"&&t.info.type==="deadline"&&(this.feeDisabled=k.no,console.log("fee enabled"))};switch(this.info.type){case"deadline":this.feeDisabled!==k.user&&this.percentData.period!=="all"?(this.feeDisabled=k.no,this.feeData.rateAffected&&(this.feeData.amount=P.lastRateChange(W,this.from),console.log("fee enabled",this.feeData.amount,this.from))):console.log("fee not enabled");break;case"rate":console.assert(typeof this.info.rate=="number"),this.percentData.rateAffected&&(this.percentData.amount=this.info.rate),this.feeData.rateAffected&&(this.feeData.amount=this.info.rate),a();break;default:a();break}}thirdStage(t,a){let[o,y]=[0,0],[D,F]=["",""];const H=(z,_,b,L)=>{let q="nothing";console.assert(!Object.entries(b).some(([de,fe])=>(q=de,_t(fe)||fe!==0&&typeof fe!="boolean"&&!fe)),"Checkpoint data nan or falsy",q,this.info,b);let O,B="";if(b.period==="year")if(b.type==="percent"){const de=b.one300th?300:this.daysInYear();O=z*(_/de)*(b.amount/100),B=V`${z} x ${_} / ${de} x ${b.amount}%`}else O=0,B="";else b.period==="all"?L!=="deadline"?(O=0,B="amogus"):b.type==="percent"?(O=z*(b.amount/100),B=V`${z} x ${b.amount}%`):(O=b.amount,B=V`${b.amount}`):b.type==="percent"?(O=z*_*(b.amount/100),B=V`${z} x ${_} x ${b.amount}%`):(O=b.amount*_,B=V`${b.amount} x ${_}`);return[O,B]};switch(this.info.type){default:if(this.info.type==="change"&&this.info.terminated){const _=te.percent(t);D+=V`${this.debt-_} + ${_} = ${this.debt}; `}if(this.percentDisabled===k.no){const[_,b]=H(this.debt,this.percentPeriod,this.percentData,this.info.type);this.info.type==="deadline"&&h.is?(o=h.amount-w,D=`${w} - ${h.amount}`):(o=_,D=b)}if(this.feeDisabled===k.no){let[_,b]=H(this.debt,this.feePeriod,this.feeData,this.info.type);if(i.is){let L;i.type==="percent"?L=Y*(i.amount/100):L=i.amount,console.assert(L!==void 0,"feeLimited type is not percent or money",i);const q=te.fee(t);q+_>L&&(_=L-q,this.feeDisabled=k.user)}y=_,F=b}if(console.log("percent.returnMore",e.percent.returnMore),e.percent.returnMore&&this.info.type==="deadline"){const _=+e.percent.returnMore;isNaN(_)&&console.error("return more is nan"),o=_-this.debt,D=V`${_} - ${this.debt}`}break;case"charge":this.info.amountPercent>0&&(o=+this.info.amountPercent,D=V`+${o}`),this.info.amountFee>0&&(y=+this.info.amountFee,F=V`${this.info.amountPercent===0?"+":""}${y}`);break;case"payment":const z=(this.info.amountIncrease??0)-+(this.info.amountDecrease??0);if(z>=0){const _=this.debt+z,b=Math.min(w,_);D=V`${this.debt} + ${z} = ${_}`,this.debt=b,this.enrichment+=_-b,console.assert(_>=b,"added enrichment cant be negative buddy")}else{const _=(O,B)=>[Math.max(O-B,0),Math.abs(Math.min(O-B,0))],b=te.percent(t);console.assert(b>=0,"prior sum is negative for some reason",b);const[L,q]=_(b,Math.abs(z));if(console.assert(L>=0,"im pretty sure percent can't be negative here",L),console.assert(q>=0,"remainder can't be negative as well",q),q<=0)D=V`${b} - ${Math.abs(z)} = ${L}`,o=-Math.abs(z),y=0;else{o=-b,D=V`${b} - ${Math.abs(z)} = -${q}`,this.enrichment,this.enrichment-=q;const O=this.enrichment;O<0&&(this.debt+=O,this.enrichment=0)}}break}const X=D!==""&&F!==""?" + ":" ";this.debt=Math.round(this.debt*100)/100,this.formula=`${D}${X}${F}`,this.calculatedPercent=o,this.calculatedFee=y}};let T=new C("start",n),I,v;g.period==="all"?v=new Date(n.getTime()+1e3):v=P.addDays(r,1),I=new C("deadline",v),v>l&&(l=P.addDays(v,1));const j=new C("halt",l);console.log("endhalt",r,l);const R=u.map(t=>new C(t.type,t.date,t.data));let E=R.sort((t,a)=>t.from-a.from).filter(t=>t.info.type==="change").map(t=>({percent:{period:t.info.percentPeriod,type:t.info.percentType,amount:t.info.percentAmount},fee:{period:t.info.feePeriod,type:t.info.feeType,amount:t.info.feeAmount},date:t.from}));E=[{percent:g,fee:m},...E,{fee:{period:"year",type:"percent"},percent:{period:"year",type:"percent"},date:new Date(new Date().getTime()*1.15)}];const Z={__shared:(t,a)=>{for(let o=0;o<E.length;o++)if(E[o].date>=t&&E[o-1])return E[o-1][a];return E[E.length-1][a]},percent:t=>Z.__shared(t,"percent"),fee:t=>Z.__shared(t,"fee")},le=(t,a)=>{let o=a.getFullYear()-t.getFullYear();return(t.getMonth()>a.getMonth()||t.getMonth()===a.getMonth()&&t.getDate()>a.getDate())&&o--,o};{let t=le(n,l),a=0;do{const o=new Date(n.getFullYear()+ ++a,n.getMonth(),n.getDate()),y=Z.percent(o),D=Z.fee(o),F=(X=>X.period==="year"&&X.type==="money")(y),H=(X=>X.period==="year"&&X.type==="money")(D);(F||H)&&t!==0&&R.push(new C("charge",o,{amountFee:D.amount,amountPercent:y.amount,yearlyCharge:!0}))}while(--t>0)}const Pe=t=>{const a=[],o=F=>F%400===0||F%100!==0&&F%4===0?366:365;let y=o(n.getFullYear()),D=new Date(t);console.log("halt",l);do{if(D.setYear(D.getFullYear()+1),o(D.getFullYear())!==y&&D<l){const F=new Date(D.getFullYear(),0,1);F.toLocaleDateString("ru")!==r.toLocaleDateString("ru")&&a.push(new C("leapYear",F))}y=o(D.getFullYear())}while(D<l);return a};//! First weird decision
const ye=u.filter(t=>t.type==="change"&&t.data.terminated);console.assert(ye.length<=1,"more than one termination change event present",u);const Ce=ye.length===1,Fe=(Ne=ye[0])==null?void 0:Ne.date,Ve=t=>t.map(a=>{const o=`${a.getFullYear()},${a.getMonth()},${a.getDate()}`;return console.assert(W[o]!==void 0,"fee rate at date is falsey",W[o],o),new C("rate",a,{terminated:Ce&&Fe&&a.getTime()>=Fe.getTime(),rate:W[o]})});let be;g.amount===0?be="cb":be=g.period;let ie;m.one300th?ie="1_300":m.amount===0?ie="cb":ie=m.period;let Me=Object.keys(W).map(t=>new Date(...t.split(","))),at=Ve(P.datesInSpan(Me,n,l)),Te=Ve(P.datesInSpan(Me,r,l)),rt=Pe(n),lt=Pe(r);const f=(t,a)=>({rate:t,leap:a}),it={day:{day:f("no","no"),week:f("no","no"),month:f("no","no"),year:f("no","deadline"),cb:f("deadline","deadline"),"1_300":f("deadline","no"),all:f("no","no")},week:{day:f("no","no"),week:f("no","no"),month:f("no","no"),year:f("no","deadline"),cb:f("deadline","deadline"),"1_300":f("deadline","no"),all:f("no","no")},month:{day:f("no","no"),week:f("no","no"),month:f("no","no"),year:f("no","deadline"),cb:f("deadline","deadline"),"1_300":f("deadline","no"),all:f("no","no")},year:{day:f("no","yes"),week:f("no","yes"),month:f("no","yes"),year:f("no","yes"),cb:f("deadline","yes"),"1_300":f("deadline","yes"),all:f("no","yes")},cb:{day:f("yes","yes"),week:f("yes","yes"),month:f("yes","yes"),year:f("yes","yes"),cb:f("yes","yes"),"1_300":f("yes","yes"),all:f("yes","yes")},all:{day:f("no","no"),week:f("no","no"),month:f("no","no"),year:f("no","deadline"),cb:f("deadline","deadline"),"1_300":f("deadline","no"),all:f("no","no")}},ze=(t,a,o)=>{try{switch(it[be][ie][t]){case"no":return[];case"yes":return a;case"deadline":return o}}catch(y){throw y}};let ee=ze("rate",at,Te),ot=ze("leap",rt,lt);if(ee==Te&&ee.length>0){const t=ee[0];t.from=r}console.log({rateChangeCheckpoints:ee}),c=[T,...I===void 0?[]:[I],...ee,...R,...ot,j].sort((t,a)=>t.from-a.from),c.forEach((t,a)=>{if(t===void 0)throw console.debug("Checkpoint can't be undefined dummy",a,c,{start:T,deadline:I,rateChangeCheckpoints:ee,eventCheckpoints:R,halt:j}),Error("Checkpoint can't be undefined dummy")});for(let t=0;t<c.length;t++){const a=c[t];//! 01.01.2020 | 31.12.2019 | ... synthetic
a.info.type!=="synthetic"&&a.info.oneDay&&!a.info.yearlyCharge&&a.from>=n&&(a.info.type==="payment"?a.info.amountIncrease-a.info.amountDecrease>0?c.splice(t+1,0,new C("synthetic",a.from)):c.splice(t+1,0,new C("synthetic",P.addDays(a.from,1))):c.splice(t+1,0,new C("synthetic",P.addDays(a.from,1))))}//! use only in third stage
const te={__shared:(t,a)=>{if(t<=0)return console.warn("probably shouldn't happen"),0;let o=0;for(let y=0;y<t;y++)console.assert(typeof c[y][a]=="number","sumprior prop isn't a number",c[t][a]),o+=c[y][a];return o},percent:t=>te.__shared(t,"calculatedPercent"),fee:t=>te.__shared(t,"calculatedFee")},Oe=JSON.parse(JSON.stringify(c));console.debug("Checkpoints before calculation",Oe),console.debug(Oe.map(t=>[t.info.type,new Date(t.from)]));const Ie=Q(c,c.findIndex(t=>t.info.type==="start"));T.startSpecial({total:Y,calculatorData:e,nextCheckpoint:Ie,returnMore:h}),T.secondStage({previousCheckpoint:T}),T.thirdStage(0,Ie);//! cringe but i can't think of a better solution that won't take forever
const oe=c.findIndex(t=>t.info.type==="start");if(oe!==0){const t=c.slice(0,oe);console.log("checkps before start"),t[0].debt=0;for(let a=0;a<oe;a++){const o=t[a];switch(o.info.type){case"payment":o.thirdStage(a),T.debt+=o.debt,T.enrichment=o.enrichment,console.log("b4",a,o.info.type,o.info,o.calculatedFee,o.calculatedPercent,o.enrichment);break;default:throw console.error("chk",o,c),Error("only payment before start is supported "+o.info.type)}}}for(let t=oe+1;t<c.length-1;t++){const a=c[t];let o=Q(c,t);o.info.type==="halt"&&(o=c[t+1]);try{a.firstStage({previousCheckpoint:c[t-1],nextCheckpoint:c[t+1],index:t})}catch(y){throw console.debug("Error in stage 1: ",y),console.debug(a,c[t-1],o),y}try{a.secondStage({previousCheckpoint:c[t-1]})}catch(y){throw console.debug("Error in stage 2: ",y),console.debug(a),y}try{a.thirdStage(t,o)}catch(y){throw console.debug("Error in stage 3: ",y),console.debug(a,o),y}}//! Remove 'halt'
//! removes deadline under certain circumstances lol
c.at(-1).info.type==="deadline"&&console.log("crashed",c.at(-1)),c=c.filter(t=>t.info.type!=="halt");let N=c[c.length-1],ne,[se,ue,st,ce]=[0,0,0,null];console.log("checkpoints",c.map(t=>t.info.type));for(let t=0;t<c.length;t++){const a=c[t];a.info.type==="change"&&a.info.terminated&&(ce=c[t-1].debt),se+=a.calculatedPercent,ue+=a.calculatedFee,a.info.type==="payment"&&(st+=a.info.amountDecrease-a.info.amountIncrease),a.info.type==="deadline"&&(ne=a)}ce===null&&(ce=N.debt);//! cringe
if(ne.feeData.period==="all"&&ne.percentData.period!=="all"){const[t,a]=ne.formula.split(" + ");N.formula+=" + "+a,I.formula=t,N.feePeriod=I.feePeriod,N.feeData={...I.feeData},N.feeDisabled=k.no,N.calculatedFee=I.calculatedFee,ne.feeDisabled=k.user,ne.calculatedFee=0}const je=se+ue+c[c.length-1].debt,Re=P.gosposhlina(je+N.enrichment,d);console.log("Checkpoints after calculation",c);const Ae={debt:c[c.length-1].debt,debtBeforeTermination:Ce?ce:c[c.length-1].debt,percent:se,fee:ue,final:je,gosposhlina:{amount:Re[0],formula:Re[1]},courtType:d,enrichment:{formula:V`${N.enrichment+N.debt} - ${N.debt}`,value:N.enrichment},startDate:n,endDate:r,haltDate:l};let ve=[];return c.forEach(t=>{ve.push({Formula:t.formula,Percent:t.calculatedPercent,Fee:t.calculatedFee})}),ve.push({Formula:"Resulting Percent:",Percent:se,Fee:ue}),console.table(ve),console.log("[checkpoints, result]",[c,Ae]),[c,Ae]}var De;let P=(De=class{static datesInSpan(n,r,l){return n=n.map(i=>typeof i=="string"?new Date(i):i),n.filter(i=>i>=r&&i<l)}static lastRateChange(n,r){let[l,i]=[Object.keys(n),Object.values(n)];l=l.map(p=>new Date(p.split(","))),l.push(r),l.sort((p,h)=>p-h).reverse();const u=l.indexOf(r),d=i[Dt(u+1,0,i.length-1)];return console.assert(!!d,"last rate change is falsy",r.toLocaleDateString("ru"),d),console.debug("Last rate change of",r.toLocaleDateString("ru"),"is",d,"index",u),d}static dateDiff(n,r,l){let i;switch(n){case"year":case"day":const u=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate()),d=Date.UTC(l.getFullYear(),l.getMonth(),l.getDate());i=Math.floor((d-u)/(1e3*60*60*24))+1;break;case"week":i=Math.round((l-r)/6048e5);break;case"month":i=l.getMonth()-r.getMonth()+12*(l.getFullYear()-r.getFullYear());break;case"all":return 0;default:throw console.debug("state"),Error(`fuck off eslint ${n} ${r.toLocaleDateString("ru")??"date null"}`)}return console.assert(!!i||i>=0,"date diff is falsey",i,n,r==null?void 0:r.toLocaleDateString("ru"),l==null?void 0:l.toLocaleDateString("ru")),i}static addDays(n,r){let l=new Date(n);return l.setDate(l.getDate()+r),l}static isOneDayEvent(n){return["payment","charge"].includes(n)}},Le(De,"gosposhlina",(n,r)=>{if(r===0)return n<=2e4?[Math.max(400,n*.04),n*.04<400?"Минимальная":`${n.toFixed(2)} * 0.04`]:n<=1e5?[800+(n-2e4)*.03,`800 + (${n.toFixed(2)} - 20000) x 0.03`]:n<=2e5?[3200+(n-1e5)*.02,`3200 + (${n.toFixed(2)} - 100000) x 0.02`]:n<=1e6?[5200+(n-2e5)*.01,`5200 + (${n.toFixed(2)} - 20000) x 0.01`]:[Math.min(6e4,13200+(n-1e6)*.005),13200+(n-1e6)*.005>6e4?"Максимальная":`13200 + (${n.toFixed(2)} - 1000000 x 0.005)`];if(r===1)return n<=1e5?[Math.max(2e3,n*.04),n*.04<2e3?"Минимальная":`2000, ${n.toFixed(2)} x 0.04`]:n<=2e5?[4e3+(n-1e5)*.03,`4000 + (${n.toFixed(2)} - 100000) x 0.03`]:n<=1e6?[7e3+(n-2e5)*.02,`7000 + (${n.toFixed(2)} - 200000) x 0.02`]:n<=2e6?[23e3+(n-1e6)*.01,`23000 + (${n.toFixed(2)} - 1000000) x 0.01`]:[Math.min(2e5,33e3+(n-2e6)*.005),33e3+(n-2e6)*.005<2e5?"Максимальная":`200000, 33200 + (${n.toFixed(2)} - 2000000) x 0.005`];throw Error(`Uh-oh ${r}`)}),De);const W={"2022,8,19":7.5,"2022,6,25":8,"2022,5,14":9.5,"2022,4,27":11,"2022,4,4":14,"2022,3,11":17,"2022,1,28":20,"2022,1,14":9.5,"2021,11,20":8.5,"2021,9,25":7.5,"2021,8,13":6.75,"2021,6,26":6.5,"2021,5,15":5.5,"2021,3,26":5,"2021,2,22":4.5,"2020,6,27":4.25,"2020,5,22":4.5,"2020,3,27":5.5,"2020,1,10":6,"2019,11,16":6.25,"2019,9,28":6.5,"2019,8,9":7,"2019,6,29":7.25,"2019,5,17":7.5,"2018,11,17":7.75,"2018,8,17":7.5,"2018,2,26":7.25,"2018,1,12":7.5,"2017,11,18":7.75,"2017,9,30":8.25,"2017,8,18":8.5,"2017,5,19":9,"2017,4,2":9.25,"2017,2,27":9.75,"2016,8,19":10,"2016,5,14":10.5,"2015,7,3":11,"2015,5,16":11.5,"2015,4,5":12.5,"2015,2,16":14,"2015,1,2":15,"2014,11,16":17,"2014,11,12":10.5,"2014,10,5":9.5,"2014,6,28":8,"2014,3,28":7.5,"2014,2,3":7,"2013,8,13":5.5},k={no:0,yes:1,user:2};var $t=re("<div>"),wt=re("<tr><td colspan=2>Неосновательное обогащение:</td><td colspan=8>"),kt=re("<div><table><thead><tr><th rowspan=2 colspan=1>Долг</th><th colspan=2>Период начисления</th><th colspan=2>Периоды</th><th colspan=2>Процент</th><th rowspan=2>Формула</th><th colspan=2>Начислено</th></tr><tr><th>с</th><th>по</th><th>%</th><th>неуст.</th><th>польз.</th><th>неуст.</th><th>процент</th><th>неустойка</th></tr></thead><tbody><tr><td colspan=7></td><td>Итого:</td><td></td><td></td></tr><tr><td colspan=2>Долг:</td><td colspan=8></td></tr><tr><td colspan=2></td><td colspan=8>"),xt=re("<tr><td>. </td><td><br></td><td><br></td><td></td><td></td><td></td><td></td><td></td><td></td><td>");function Bt(){const[e]=xe(),n=()=>et(e);ke(()=>{console.log("options generated",n(),r())});const r=()=>{const l=n();return"error"in l?null:We(l)};return s(Je,{get when(){return r()},children:l=>s(St,{get checkpoints(){return l()[0]},get result(){return l()[1]}})})}function et(e){var p;const n=new Date(e.document.date);if(isNaN(n.valueOf()))return{error:"startDate is invalid"};const r=vt(e.srokVozvrata,n);if(!r)return{error:"endDate is invalid"};const l=r>new Date?Ct(r,1):new Date;let i;{let h=e.fee;switch(h.type){case"fraction":case"money":i={amount:+h.sum,type:h.type==="fraction"?"percent":"money",period:h.periodUnit,disabled:!1};break;case"not-specified":+e.document.sum>1e5||e.zaimodavec.type==="ul"||e.zaemshik.type==="ul"?i={amount:0,type:"percent",period:"year",disabled:!1}:i={amount:0,type:"percent",period:"year",disabled:!0};break;case"bigger-than-loan":i={amount:0,returnMore:h.sum,type:"percent",period:"all",disabled:!0};break;case"no-fee":i={amount:0,type:"percent",period:"year",disabled:!0};break}}let u={amount:0,type:"percent",period:"year",disabled:!1,one300th:!1};//! option
{const h=e.penalty.value;switch(h.type){case"not-specified":case"central-bank":break;case"fraction":u.type="percent",u.period=h.periodUnit,u.amount=+h.sum;break;case"money":u.type="money",u.period=h.periodUnit,u.amount=+h.sum;break;case"no-penalty":u.disabled=!0;break}}const d=[];{const h=(m,w,S)=>{d.push({date:m,type:"payment",data:{amountIncrease:w,amountDecrease:S},rand:Math.random()})};if(e.proofs.returnProofs.type==="paid"){const m=w=>{for(let{date:S,sum:Y}of w){const U=new Date(S),c=+Y;isNaN(c)||h(U,0,c)}};e.proofs.returnProofs.unbackedProofs&&m(e.proofs.returnProofs.unbackedProofs),e.proofs.returnProofs.zaemshikProofs&&m(e.proofs.returnProofs.zaemshikProofs),e.proofs.returnProofs.proofs&&m(e.proofs.returnProofs.proofs.filter(w=>"date"in w&&"sum"in w).map(w=>({date:w.date,sum:w.sum})))}let g=!1;for(const m of e.proofs.dogovorProofs)if((S=>"date"in S&&"sum"in S)(m))h(new Date(m.date),+m.sum,0);else if(m.type==="clause")g=!0,h(n,+e.document.sum,0);else if(m.type==="account-statement")for(const S of m.loanTransactions)h(new Date(S.date),+S.sum,0);!g&&e.document.type==="raspiska"&&h(n,+e.document.sum,0)}return{total:+e.document.sum,proofTotal:0,startDate:n,endDate:r,haltDate:l,percent:i,fee:u,feeLimited:{is:e.penalty.maxPenalty!==null,amount:e.penalty.maxPenalty===null?null:+e.penalty.maxPenalty,type:((p=e.penalty.maxPenalty)==null?void 0:p.type)??null},events:d,overrideFee:!1,court:Se(e)==="sou"?1:0,returnMoreThanLoan:{is:!1,amount:0}}}function St(e){ke(()=>{console.log("table generated",{...e})});const[n,r]=_e(new Date().toISOString().split("T")[0]),[l,i]=_e(!1);return[(()=>{var u=$t();return $(u,s(qe,{thin:!0,text:"Расчёт",onClick:()=>{}}),null),$(u,s(qe,{thin:!0,text:"Документ",onClick:()=>{}}),null),he(()=>J(u,G["raschet-buttons"])),u})(),s(K,{question:"Демонстрация расчёта исковых требований",noPaddingTop:!0,get children(){var u=kt(),d=u.firstChild,p=d.firstChild,h=p.nextSibling,g=h.firstChild,m=g.firstChild,w=m.nextSibling,S=w.nextSibling,Y=S.nextSibling,U=g.nextSibling,c=U.firstChild,Q=c.nextSibling,C=U.nextSibling,T=C.firstChild,I=T.nextSibling;return $(h,s(dt,{get each(){return e.checkpoints},children:(v,j)=>s(Pt,{value:v,get i(){return j()}})}),g),$(S,()=>pe(e.result.percent)),$(Y,()=>pe(e.result.fee)),$(Q,()=>V`${e.result.debt+e.result.enrichment.value} + ${e.result.percent} + ${e.result.fee} = ${e.result.final+e.result.enrichment.value}`),$(T,()=>`Госпошлина (${["arb","sou"][e.result.courtType]}):`),$(I,()=>V`${e.result.gosposhlina.formula} = ${e.result.gosposhlina.amount}`),$(h,s(Je,{get when(){return e.result.enrichment.value>=50},get children(){var v=wt(),j=v.firstChild,R=j.nextSibling;return $(R,()=>V`${e.result.enrichment.formula} = ${e.result.enrichment.value}`),he(()=>J(v,G.final)),v}}),null),he(v=>{var j=G["rounded-fix"],R=G["calculator-table"],E=G.total,Z=G.final,le=G.final;return j!==v.e&&J(u,v.e=j),R!==v.t&&J(d,v.t=R),E!==v.a&&J(g,v.a=E),Z!==v.o&&J(U,v.o=Z),le!==v.i&&J(C,v.i=le),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),u}}),s(A,{type:"date",label:"Предполагаемая дата подачи иска",get value(){return n()},setValue:r}),s(He,{label:"Рассчитать неустойку по ставке ЦБ, в случае если размер неустойки слишком велик",get value(){return l()},setValue:i})]}function Pt(e){const n=()=>{let d=e.value,p=d.info.type;if(p==="payment"){let h=d;h.info.amountIncrease>=h.info.amountDecrease?p+="-increase":p+="-decrease"}return p},r=()=>{const d=e.value;return d.debt??d.enrichment??0},l=(d,p,h)=>d.info.oneDay?"":d.percentDisabled&&(p==="percent"||p==="percentPeriod")||d.feeDisabled&&(p==="fee"||p==="feePeriod")?"-":h,i=d=>{const p={percent:"%",money:"р."},h={day:"д",week:"н",month:"м",year:"г",all:"весь"};try{return`${d.amount}${p[d.type]}/${h[d.period]}`}catch{return"err"}},u=d=>d?d instanceof Date?d.toLocaleDateString("ru"):"not a date!":"date is null!";return(()=>{var d=xt(),p=d.firstChild,h=p.firstChild,g=p.nextSibling,m=g.firstChild,w=g.nextSibling,S=w.firstChild,Y=w.nextSibling,U=Y.nextSibling,c=U.nextSibling,Q=c.nextSibling,C=Q.nextSibling,T=C.nextSibling,I=T.nextSibling;return $(p,()=>e.i,h),$(p,r,null),$(g,()=>u(e.value.from),m),$(w,()=>l(e.value,"to",u(e.value.to)),S),$(Y,()=>l(e.value,"percentPeriod",e.value.percentPeriod)),$(U,()=>l(e.value,"feePeriod",e.value.feePeriod)),$(c,()=>l(e.value,"percent",i(e.value.percentData))),$(Q,()=>l(e.value,"fee",i(e.value.feeData))),$(C,()=>e.value.formula),$(T,()=>pe(e.value.calculatedPercent)),$(I,()=>pe(e.value.calculatedFee)),he(v=>{var j=n(),R=G.checkpoint;return j!==v.e&&ft(d,"data-type",v.e=j),R!==v.t&&J(d,v.t=R),v},{e:void 0,t:void 0}),d})()}function V(e,...n){return e.map(r=>{const l=n.shift();if(l===void 0)return r;if(l==0||typeof l!="number")return r+l;if(l){const i=l.toFixed(2);return+i.split(".")[1]>0?r+i:r+l}else return r}).join("")}function pe(e){return e.toFixed(2)}function Ct(e,n){const r=new Date(e);return r.setDate(r.getDate()+n),r}var Ft=re("<div><pre>");const[me,Vt]=_e(!1);function tt(e){let n;return e===2||e===6?n=x(new yt):n=x(new bt),n.type=["arb-claim","arb-simple","arb-order","jp-claim","gen-claim","gen-simple","jp-order"][e],n}function Mt(e){return["arb-claim","arb-simple","arb-order","jp-claim","gen-claim","gen-simple","jp-order"].findIndex(n=>n===e.type)}function Tt(){const[e,n]=xe(),r=(u,d)=>{n("court",u,mt(d))},l=()=>Mt(e.court),i=u=>{n("court",tt(u))};return(()=>{var u=Ft(),d=u.firstChild;return $(u,s(K,{get children(){return[s($e,{get disabled(){return!me()},items:[{text:"1"},{text:"2"},{text:"3"},{text:"4"},{text:"5"},{text:"6"},{text:"7"}],get value(){return l()},setValue:p=>{function h(g){return g>=0&&g<=6}if(h(p))i(p);else throw new Error("Invalid court screen number")}}),s(He,{label:"Выбрать вручную",get value(){return me()},setValue:p=>{console.log(p,me()),Vt(p)}})]}}),d),$(d,()=>JSON.stringify(e.court,null,2)),$(u,s(K,{get children(){return s(ge,{get children(){return[s(M,{get when(){return l()===0},get children(){return s(ae,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return l()===1},get children(){return s(ae,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return l()===2},get children(){return s(Ue,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return l()===3},get children(){return s(ae,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return l()===4},get children(){return s(ae,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return l()===5},get children(){return s(ae,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return l()===6},get children(){return s(Ue,{get value(){return e.court},setValue:r})}})]}})}}),null),u})()}function ae(e){const n=()=>e.value.value,r=(l,i)=>{console.log("setting",x(e.value.value),l,i),e.setValue("value",{...e.value.value,[l]:i})};return s(Xe,{items:[{label:"Исковое заявление будет подано по месту жительства/нахождения должника (по умолчанию)",value:"default"},{label:"В договоре указан конкретный суд, в котором рассматриваются споры по договору",value:"specific"},{label:"Выбрать суд вручную",value:"manual"},{label:"В договоре укзаано, что дело рассматривается по месту нахождения/жительства истца",value:"zd-venue"},{label:"В договоре указано, что дело рассматривается по месту нахождения/жительства Займодавца",value:"za-venue"}],get value(){return e.value.value.type},setValue:l=>{switch(l){case"default":e.setValue("value",x(new we));break;case"specific":e.setValue("value",x(new Ze));break;case"manual":e.setValue("value",x(new Qe));break;case"zd-venue":e.setValue("value",x(new Ke));break;case"za-venue":e.setValue("value",x(new Ge));break;default:throw new Error("Invalid court claim value")}},get children(){return s(nt,{get value(){return n()},setValue:r})}})}function Ue(e){const n=()=>e.value.value,r=(i,u)=>{e.setValue("value",{...e.value.value,[i]:u})},l=()=>e.value.value.type==="objections"||e.value.value.type==="rejected"||e.value.value.type==="cancelled"?"no-order":"order";return[s(Xe,{items:[{label:"Обратиться за вынесением судебного приказа",value:"order"},{label:"Я не могу обратиться за вынесением судебного приказа",value:"no-order"}],get value(){return l()},setValue:i=>{i==="order"?e.setValue("value",x(new we)):e.setValue("value",x(new Be))}}),s(K,{get children(){return s(ge,{get children(){return[s(M,{get when(){return l()==="order"},get children(){return[s($e,{tallerRows:!0,items:[{text:"Исковое заявление будет подано по месту жительства/нахождения должника (по умолчанию)",value:"default"},{text:"В договоре указан конкретный суд, в котором рассматриваются споры по договору",value:"specific"},{text:"Выбрать суд вручную",value:"manual"},{text:"В договоре укзаано, что дело рассматривается по месту нахождения/жительства истца",value:"zd-venue"},{text:"В договоре указано, что дело рассматривается по месту нахождения/жительства Займодавца",value:"za-venue"}],get value(){return e.value.value.type},setValue:i=>{switch(i){case"default":e.setValue("value",x(new we));break;case"specific":e.setValue("value",x(new Ze));break;case"manual":e.setValue("value",x(new Qe));break;case"zd-venue":e.setValue("value",x(new Ke));break;case"za-venue":e.setValue("value",x(new Ge));break;default:throw new Error("Invalid court claim (order) value")}}}),s(nt,{get value(){return n()},setValue:r})]}}),s(M,{get when(){return l()==="no-order"},get children(){return[s($e,{tallerRows:!0,items:[{text:"У меня имеются письменные возражения заёмщика относительно спорной задолженности.",value:"objections"},{text:"Я уже обращался с заявлением о вынесении судебного приказа, однако Арбитражный суд вынес определение об отказе в принятии заявления о вынесении судебного приказа",value:"rejected"},{text:"Я уже обращался с заявлением о вынесении судебного приказа, однако судебный приказ был отменён в связи с подачей возражений должника.",value:"cancelled"}],get value(){return e.value.value.type},setValue:i=>{switch(i){case"objections":e.setValue("value",x(new Be));break;case"rejected":e.setValue("value",x(new pt));break;case"cancelled":e.setValue("value",x(new gt));break;default:throw new Error("Invalid court claim (no-order) value")}}}),s(ge,{get children(){return[s(M,{get when(){return e.value.value.type==="objections"},get children(){return[s(A,{label:"Наименование документа",get value(){return e.value.value.date},setValue:i=>r("name",i)}),s(A,{type:"date",label:"Дата документа",get value(){return e.value.value.date},setValue:i=>r("date",i)})]}}),s(M,{get when(){return e.value.value.type==="rejected"},get children(){return[s(A,{type:"date",label:"Дата определения об отказе в принятии заявления о вынесении судебного приказа",get value(){return e.value.value.date},setValue:i=>r("date",i)}),s(A,{label:"Номер дела из картотеки арбитражных дел",get value(){return e.value.value.date},setValue:i=>r("case",i)})]}}),s(M,{get when(){return e.value.value.type==="cancelled"},get children(){return[s(A,{type:"date",label:"Дата определения об отказе в принятии заявления о вынесении судебного приказа",get value(){return e.value.value.date},setValue:i=>r("date",i)}),s(A,{label:"Номер дела из картотеки арбитражных дел",get value(){return e.value.value.date},setValue:i=>r("case",i)})]}})]}})]}})]}})}})]}function nt(e){return s(ge,{get children(){return[s(M,{get when(){return e.value.type==="specific"},get children(){return s(K,{get children(){return[s(A,{label:"Наименование суда",get value(){return e.value.name},setValue:n=>e.setValue("name",n)}),s(A,{label:"Пункт договора",get value(){return e.value.clause},setValue:n=>e.setValue("clause",n)})]}})}}),s(M,{get when(){return e.value.type==="manual"},get children(){return s(K,{get children(){return s(A,{label:"Наименование суда",get value(){return e.value.name},setValue:n=>e.setValue("name",n)})}})}}),s(M,{get when(){return e.value.type==="zd-venue"},get children(){return s(K,{get children(){return s(A,{label:"Пункт договора",get value(){return e.value.clause},setValue:n=>e.setValue("clause",n)})}})}}),s(M,{get when(){return e.value.type==="za-venue"},get children(){return s(K,{get children(){return s(A,{label:"Пункт договора",get value(){return e.value.clause},setValue:n=>e.setValue("clause",n)})}})}})]}})}function zt(e){const[n,r]=xe();return ke(ht(()=>e.currentCrumb,()=>{var i;if(me()){console.log("court value overriden - not reacting");return}(i=n.zaimodavec)==null||i.lastName;const l=et(n);if("error"in l)console.log("court react no calculate",l);else{const u=We(l);if(u){const[,{final:d,enrichment:p}]=u,h=()=>"liquidation"in n.zaimodavec&&n.zaimodavec.liquidation!==null||"liquidation"in n.zaemshik&&n.zaemshik.liquidation!==null,g=Ot(d,n.zaimodavec.type,h(),Se(n),p.value>50),m=tt(g.initialScreen-1);console.log("court react",l,u,g,"setting to:",m,"(1-indexed!)"),r("court",x(m))}else console.log("court react calculation fail",l,u)}})),null}function Se(e){return e.zaemshik.type==="fl"||e.zaimodavec.type==="fl"||e.zaimodavec.type==="ip"&&e.zaimodavec.liquidation!==null||e.zaemshik.type==="ip"&&e.zaemshik.liquidation!==null?"sou":"arb"}function Ot(e,n,r,l,i=!1){let u=1,d="pretenzia";return l=="arb"&&!r?n==="ul"?e>8e5?(u=1,d="pretenzia"):e>5e5?(u=2,d="gppz"):i||(u=3,d="gppz"):n==="ip"&&(e>5e5?u=1:u=3):e>5e5?(u=5,d="gppz"):!i&&e>5e4?u=7:u=4,console.log("pick court type",e,n,r,l,i,u),{initialScreen:u,screenAfterCourt:d}}const Ut=Object.freeze(Object.defineProperty({__proto__:null,CourtReactToFlow:zt,courtType:Se,default:Tt},Symbol.toStringTag,{value:"Module"}));export{Bt as C,Ut as a};
