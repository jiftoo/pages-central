var ut=Object.defineProperty;var ct=(e,t,r)=>t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Be=(e,t,r)=>(ct(e,typeof t!="symbol"?t+"":t,r),r);import{k as $e,l as s,S as Ke,h as pe,i as w,c as he,a as J,F as dt,p as ft,t as re,_ as ht,C as ge,M,J as mt}from"./index-CJwTej7D.js";import{Q as K,T as E}from"./TextField-BlZifFvP.js";import{D as ke}from"./DropdownSelect-BN9pC9ke.js";import{u as xe,B as Ue,d as S,C as pt,A as gt,r as yt,E as Qe,G as Ze,H as ye,J as He,K as we,O as Je,Q as bt,T as vt,a as Dt}from"./DocumentFlow-DLrAGQ6P.js";import{C as Xe}from"./Checkbox-BrUttJ43.js";import{calculateReturnDate as _t}from"./SrokVozvrata-vHAft2v3.js";import{R as We}from"./RadioGroup-A9oWCaRG.js";const G={"demo-name":"_demo-name_1ihfr_1","raschet-buttons":"_raschet-buttons_1ihfr_10","calculator-table":"_calculator-table_1ihfr_35","rounded-fix":"_rounded-fix_1ihfr_71","checkpoint-glow":"_checkpoint-glow_1ihfr_189","checkpoint-start":"_checkpoint-start_1ihfr_192","checkpoint-deadline":"_checkpoint-deadline_1ihfr_195","checkpoint-payment-decrease":"_checkpoint-payment-decrease_1ihfr_198","checkpoint-payment-increase":"_checkpoint-payment-increase_1ihfr_201","checkpoint-change":"_checkpoint-change_1ihfr_204","checkpoint-change-term":"_checkpoint-change-term_1ihfr_207","checkpoint-leapYear":"_checkpoint-leapYear_1ihfr_210","checkpoint-charge":"_checkpoint-charge_1ihfr_213","checkpoint-synthetic":"_checkpoint-synthetic_1ihfr_216","checkpoint-idk":"_checkpoint-idk_1ihfr_219"};function kt(e,t,r){return Math.max(t,Math.min(e,r))}function wt(e){return typeof e=="number"&&isNaN(e)&&e!==e}function et(e){var Ye,Le,qe;let{startDate:t,endDate:r,haltDate:a,feeLimited:l,events:u,court:c,overrideFee:m,returnMoreThanLoan:f}=e;//! If percent.amount is 0, then it is affected by rate changes, but
//! if percent.amount is "0", then it is actually just zero percent/period
const g={...e.percent},p={...e.fee};g.amount=g.amount||g.amount==0?+g.amount.toString().replace(",","."):null,p.amount=p.amount||p.amount==0?+p.amount.toString().replace(",","."):null,m&&(p.amount=0,p.type="percent",p.period="year");const D=(Ye=e.total)!=null&&Ye.replace?+e.total.replace(",","."):+e.total,$=(Le=e.proofTotal)!=null&&Le.replace?+e.proofTotal.replace(",","."):e.proofTotal;console.debug("totals",D,$,Math.min(D,$));const T=Math.min(D,$);if([T,t,r,a,Object.values(g),Object.values(p)].some(n=>n===null||n===""))return console.debug("Not enouugh data to calculate",Object.fromEntries(Object.entries({total:T,startDate:t,endDate:r,haltDate:a,percent:g,fee:p}).filter(([n,i])=>i===null||i===""))),null;const U=["debt","to","percentPeriod","feePeriod","percentData","feeData","percentDisabled","feeDisabled","formula","calculatedPercent","calculatedFee"];let d=null;const Q=(n,i)=>{try{const o=n.indexOf(n.slice(i+1).find(y=>!y.info.oneDay));return console.assert(o>0,"next multiple day checkpoint index is <= 0",o,i),n[o]}catch(o){throw console.debug(n,i,n.slice(i+1)),o}},P=class{constructor(n,i,o={}){this.from=i,this.terminated=o.terminated??!1,this.enrichment=0,this.info={...o,type:n},this.info.oneDay=C.isOneDayEvent(this.info.type),U.forEach(y=>this[y]=null)}daysInYear(){const n=this.from.getFullYear();return n%400===0||n%100!==0&&n%4===0?366:365}startSpecial({total:n,calculatorData:i,nextCheckpoint:o,returnMore:y}){this.debt=n,this.to=o.info.type==="deadline"?C.addDays(o.from,-1):o.from,this.percentPeriod=C.dateDiff(i.percent.period,this.from,this.to),this.feePeriod=C.dateDiff(i.fee.period,this.from,this.to);const _=C.lastRateChange(W,this.from),F=g.amount===0&&!y.is;console.assert(!!_,"lastRateChange is falsey",_),console.assert(!!g.amount||g.amount===0,"percent.amount is falsey",g.amount),this.percentData={amount:F?_:g.amount,type:g.type,period:g.period,rateAffected:F};const H=p.amount===0;this.feeData={amount:H?_:p.amount,type:p.type,period:p.period,rateAffected:H,one300th:p.one300th},this.percentDisabled=i.percent.disabled?x.user:x.no,this.feeDisabled=i.fee.disabled?x.user:x.yes}firstStage({previousCheckpoint:n,nextCheckpoint:i,index:o}){this.from<t||(this.debt=n.debt,this.enrichment=n.enrichment,this.info.type==="deadline"&&n.percentData.period==="all"?this.to=r:i.info.type==="payment"?i.info.amountIncrease-i.info.amountDecrease>0?this.to=this.info.oneDay?null:C.addDays(i.from,-1):this.to=this.info.oneDay?null:i.from:i.info.type==="halt"?this.to=this.info.oneDay?null:i.from:this.to=this.info.oneDay?null:C.addDays(i.from,-1),this.percentPeriod=n.percentPeriod,this.feePeriod=n.feePeriod,this.percentData={...n.percentData},this.feeData={...n.feeData},this.percentDisabled=n.percentDisabled,this.feeDisabled=n.feeDisabled,n.info.type==="deadline"&&(n.percentData.period==="all"&&(this.percentDisabled=x.user),n.feeData.period==="all"&&(this.feeDisabled=x.user)),(n.terminated||this.terminated)&&(this.terminated=!0,n.terminated||(this.debt+=te.percent(o)),this.percentDisabled=x.user,this.feeData.period="year",this.feeData.type="percent",this.info.type==="rate"?this.feeData.amount=this.info.rate:this.feeData.amount=C.lastRateChange(W,this.from)))}secondStage({previousCheckpoint:n}){this.info.type==="change"&&(this.info.percentAmount!==null&&(this.percentData.type=this.info.percentType,this.percentData.period=this.info.percentPeriod,this.percentData.amount=this.info.percentAmount,this.percentData.rateAffected=!1),this.info.feeAmount!==null&&(this.feeData.type=this.info.feeType,this.feeData.period=this.info.feePeriod,this.feeData.amount=this.info.feeAmount,this.feeData.rateAffected=!1),this.terminated||(this.percentDisabled=this.info.percentDisabled?x.user:x.no),this.feeDisabled=this.feeDisabled===x.user?x.user:this.info.feeDisabled?x.yes:x.no),this.info.oneDay?this.percentPeriod=this.feePeriod=null:(this.percentPeriod=C.dateDiff(this.percentData.period,this.from,this.to),this.info.type==="synthetic"&&console.debug("period",this.percentData.period,this.from,this.to,this.percentPeriod),this.feePeriod=C.dateDiff(this.feeData.period,this.from,this.to));const i=()=>{this.percentData&&this.percentData.period==="all"&&n.info.type==="deadline"&&(this.feeDisabled=x.no,console.debug("fee enabled"))};switch(this.info.type){case"deadline":this.feeDisabled!==x.user&&this.percentData.period!=="all"?(this.feeDisabled=x.no,this.feeData.rateAffected&&(this.feeData.amount=C.lastRateChange(W,this.from),console.debug("fee enabled",this.feeData.amount,this.from))):console.debug("fee not enabled");break;case"rate":console.assert(typeof this.info.rate=="number"),this.percentData.rateAffected&&(this.percentData.amount=this.info.rate),this.feeData.rateAffected&&(this.feeData.amount=this.info.rate),i();break;default:i();break}}thirdStage(n,i){let[o,y]=[0,0],[_,F]=["",""];const H=(O,k,b,L)=>{let q="nothing";console.assert(!Object.entries(b).some(([de,fe])=>(q=de,wt(fe)||fe!==0&&typeof fe!="boolean"&&!fe)),"Checkpoint data nan or falsy",q,this.info,b);let N,B="";if(b.period==="year")if(b.type==="percent"){const de=b.one300th?300:this.daysInYear();N=O*(k/de)*(b.amount/100),B=V`${O} x ${k} / ${de} x ${b.amount}%`}else N=0,B="";else b.period==="all"?L!=="deadline"?(N=0,B="amogus"):b.type==="percent"?(N=O*(b.amount/100),B=V`${O} x ${b.amount}%`):(N=b.amount,B=V`${b.amount}`):b.type==="percent"?(N=O*k*(b.amount/100),B=V`${O} x ${k} x ${b.amount}%`):(N=b.amount*k,B=V`${b.amount} x ${k}`);return[N,B]};switch(this.info.type){default:if(this.info.type==="change"&&this.info.terminated){const k=te.percent(n);_+=V`${this.debt-k} + ${k} = ${this.debt}; `}if(this.percentDisabled===x.no){const[k,b]=H(this.debt,this.percentPeriod,this.percentData,this.info.type);this.info.type==="deadline"&&f.is?(o=f.amount-D,_=`${D} - ${f.amount}`):(o=k,_=b)}if(this.feeDisabled===x.no){let[k,b]=H(this.debt,this.feePeriod,this.feeData,this.info.type);if(l.is){let L;l.type==="percent"?L=T*(l.amount/100):L=l.amount,console.assert(L!==void 0,"feeLimited type is not percent or money",l);const q=te.fee(n);q+k>L&&(k=L-q,this.feeDisabled=x.user)}y=k,F=b}if(console.debug("percent.returnMore",e.percent.returnMore),e.percent.returnMore&&this.info.type==="deadline"){const k=+e.percent.returnMore;isNaN(k)&&console.error("return more is nan"),o=k-this.debt,_=V`${k} - ${this.debt}`}break;case"charge":this.info.amountPercent>0&&(o=+this.info.amountPercent,_=V`+${o}`),this.info.amountFee>0&&(y=+this.info.amountFee,F=V`${this.info.amountPercent===0?"+":""}${y}`);break;case"payment":const O=(this.info.amountIncrease??0)-+(this.info.amountDecrease??0);if(O>=0){const k=this.debt+O,b=Math.min(D,k);_=V`${this.debt} + ${O} = ${k}`,this.debt=b,this.enrichment+=k-b,console.assert(k>=b,"added enrichment cant be negative buddy")}else{const k=(N,B)=>[Math.max(N-B,0),Math.abs(Math.min(N-B,0))],b=te.percent(n);console.assert(b>=0,"prior sum is negative for some reason",b);const[L,q]=k(b,Math.abs(O));if(console.assert(L>=0,"im pretty sure percent can't be negative here",L),console.assert(q>=0,"remainder can't be negative as well",q),q<=0)_=V`${b} - ${Math.abs(O)} = ${L}`,o=-Math.abs(O),y=0;else{o=-b,_=V`${b} - ${Math.abs(O)} = -${q}`,this.enrichment,this.enrichment-=q;const N=this.enrichment;N<0&&(this.debt+=N,this.enrichment=0)}}break}const X=_!==""&&F!==""?" + ":" ";this.debt=Math.round(this.debt*100)/100,this.formula=`${_}${X}${F}`,this.calculatedPercent=o,this.calculatedFee=y}};let z=new P("start",t),I,v;g.period==="all"?v=new Date(t.getTime()+1e3):v=C.addDays(r,1),I=new P("deadline",v),v>a&&(a=C.addDays(v,1));const A=new P("halt",a);console.debug("endhalt",r,a);const j=u.map(n=>new P(n.type,n.date,n.data));let R=j.sort((n,i)=>n.from-i.from).filter(n=>n.info.type==="change").map(n=>({percent:{period:n.info.percentPeriod,type:n.info.percentType,amount:n.info.percentAmount},fee:{period:n.info.feePeriod,type:n.info.feeType,amount:n.info.feeAmount},date:n.from}));R=[{percent:g,fee:p},...R,{fee:{period:"year",type:"percent"},percent:{period:"year",type:"percent"},date:new Date(new Date().getTime()*1.15)}];const Z={__shared:(n,i)=>{for(let o=0;o<R.length;o++)if(R[o].date>=n&&R[o-1])return R[o-1][i];return R[R.length-1][i]},percent:n=>Z.__shared(n,"percent"),fee:n=>Z.__shared(n,"fee")},ie=(n,i)=>{let o=i.getFullYear()-n.getFullYear();return(n.getMonth()>i.getMonth()||n.getMonth()===i.getMonth()&&n.getDate()>i.getDate())&&o--,o};{let n=ie(t,a),i=0;do{const o=new Date(t.getFullYear()+ ++i,t.getMonth(),t.getDate()),y=Z.percent(o),_=Z.fee(o),F=(X=>X.period==="year"&&X.type==="money")(y),H=(X=>X.period==="year"&&X.type==="money")(_);(F||H)&&n!==0&&j.push(new P("charge",o,{amountFee:_.amount,amountPercent:y.amount,yearlyCharge:!0}))}while(--n>0)}const Pe=n=>{const i=[],o=F=>F%400===0||F%100!==0&&F%4===0?366:365;let y=o(t.getFullYear()),_=new Date(n);console.debug("halt",a);do{if(_.setYear(_.getFullYear()+1),o(_.getFullYear())!==y&&_<a){const F=new Date(_.getFullYear(),0,1);F.toLocaleDateString("ru")!==r.toLocaleDateString("ru")&&i.push(new P("leapYear",F))}y=o(_.getFullYear())}while(_<a);return i};//! First weird decision
const ve=u.filter(n=>n.type==="change"&&n.data.terminated);console.assert(ve.length<=1,"more than one termination change event present",u);const Fe=ve.length===1,Ve=(qe=ve[0])==null?void 0:qe.date,Me=n=>n.map(i=>{const o=`${i.getFullYear()},${i.getMonth()},${i.getDate()}`;return console.assert(W[o]!==void 0,"fee rate at date is falsey",W[o],o),new P("rate",i,{terminated:Fe&&Ve&&i.getTime()>=Ve.getTime(),rate:W[o]})});let De;g.amount===0?De="cb":De=g.period;let le;p.one300th?le="1_300":p.amount===0?le="cb":le=p.period;let Te=Object.keys(W).map(n=>new Date(...n.split(","))),at=Me(C.datesInSpan(Te,t,a)),ze=Me(C.datesInSpan(Te,r,a)),rt=Pe(t),it=Pe(r);const h=(n,i)=>({rate:n,leap:i}),lt={day:{day:h("no","no"),week:h("no","no"),month:h("no","no"),year:h("no","deadline"),cb:h("deadline","deadline"),"1_300":h("deadline","no"),all:h("no","no")},week:{day:h("no","no"),week:h("no","no"),month:h("no","no"),year:h("no","deadline"),cb:h("deadline","deadline"),"1_300":h("deadline","no"),all:h("no","no")},month:{day:h("no","no"),week:h("no","no"),month:h("no","no"),year:h("no","deadline"),cb:h("deadline","deadline"),"1_300":h("deadline","no"),all:h("no","no")},year:{day:h("no","yes"),week:h("no","yes"),month:h("no","yes"),year:h("no","yes"),cb:h("deadline","yes"),"1_300":h("deadline","yes"),all:h("no","yes")},cb:{day:h("yes","yes"),week:h("yes","yes"),month:h("yes","yes"),year:h("yes","yes"),cb:h("yes","yes"),"1_300":h("yes","yes"),all:h("yes","yes")},all:{day:h("no","no"),week:h("no","no"),month:h("no","no"),year:h("no","deadline"),cb:h("deadline","deadline"),"1_300":h("deadline","no"),all:h("no","no")}},Oe=(n,i,o)=>{try{switch(lt[De][le][n]){case"no":return[];case"yes":return i;case"deadline":return o}}catch(y){throw y}};let ee=Oe("rate",at,ze),ot=Oe("leap",rt,it);if(ee==ze&&ee.length>0){const n=ee[0];n.from=r}console.debug({rateChangeCheckpoints:ee}),d=[z,...I===void 0?[]:[I],...ee,...j,...ot,A].sort((n,i)=>n.from-i.from),d.forEach((n,i)=>{if(n===void 0)throw console.debug("Checkpoint can't be undefined dummy",i,d,{start:z,deadline:I,rateChangeCheckpoints:ee,eventCheckpoints:j,halt:A}),Error("Checkpoint can't be undefined dummy")});for(let n=0;n<d.length;n++){const i=d[n];//! 01.01.2020 | 31.12.2019 | ... synthetic
i.info.type!=="synthetic"&&i.info.oneDay&&!i.info.yearlyCharge&&i.from>=t&&(i.info.type==="payment"?i.info.amountIncrease-i.info.amountDecrease>0?d.splice(n+1,0,new P("synthetic",i.from)):d.splice(n+1,0,new P("synthetic",C.addDays(i.from,1))):d.splice(n+1,0,new P("synthetic",C.addDays(i.from,1))))}//! use only in third stage
const te={__shared:(n,i)=>{if(n<=0)return console.warn("probably shouldn't happen"),0;let o=0;for(let y=0;y<n;y++)console.assert(typeof d[y][i]=="number","sumprior prop isn't a number",d[n][i]),o+=d[y][i];return o},percent:n=>te.__shared(n,"calculatedPercent"),fee:n=>te.__shared(n,"calculatedFee")},Ne=JSON.parse(JSON.stringify(d));console.debug("Checkpoints before calculation",Ne),console.debug(Ne.map(n=>[n.info.type,new Date(n.from)]));const Ie=Q(d,d.findIndex(n=>n.info.type==="start"));z.startSpecial({total:T,calculatorData:e,nextCheckpoint:Ie,returnMore:f}),z.secondStage({previousCheckpoint:z}),z.thirdStage(0,Ie);//! cringe but i can't think of a better solution that won't take forever
const oe=d.findIndex(n=>n.info.type==="start");if(oe!==0){const n=d.slice(0,oe);console.debug("checkps before start"),n[0].debt=0;for(let i=0;i<oe;i++){const o=n[i];switch(o.info.type){case"payment":o.thirdStage(i),z.debt+=o.debt,z.enrichment=o.enrichment,console.debug("b4",i,o.info.type,o.info,o.calculatedFee,o.calculatedPercent,o.enrichment);break;default:throw console.error("chk",o,d),Error("only payment before start is supported "+o.info.type)}}}for(let n=oe+1;n<d.length-1;n++){const i=d[n];let o=Q(d,n);o.info.type==="halt"&&(o=d[n+1]);try{i.firstStage({previousCheckpoint:d[n-1],nextCheckpoint:d[n+1],index:n})}catch(y){throw console.debug("Error in stage 1: ",y),console.debug(i,d[n-1],o),y}try{i.secondStage({previousCheckpoint:d[n-1]})}catch(y){throw console.debug("Error in stage 2: ",y),console.debug(i),y}try{i.thirdStage(n,o)}catch(y){throw console.debug("Error in stage 3: ",y),console.debug(i,o),y}}//! Remove 'halt'
//! removes deadline under certain circumstances lol
d.at(-1).info.type==="deadline"&&console.debug("crashed",d.at(-1)),d=d.filter(n=>n.info.type!=="halt");let Y=d[d.length-1],ne,[se,ue,st,ce]=[0,0,0,null];console.debug("checkpoints",d.map(n=>n.info.type));for(let n=0;n<d.length;n++){const i=d[n];i.info.type==="change"&&i.info.terminated&&(ce=d[n-1].debt),se+=i.calculatedPercent,ue+=i.calculatedFee,i.info.type==="payment"&&(st+=i.info.amountDecrease-i.info.amountIncrease),i.info.type==="deadline"&&(ne=i)}ce===null&&(ce=Y.debt);//! cringe
if(ne.feeData.period==="all"&&ne.percentData.period!=="all"){const[n,i]=ne.formula.split(" + ");Y.formula+=" + "+i,I.formula=n,Y.feePeriod=I.feePeriod,Y.feeData={...I.feeData},Y.feeDisabled=x.no,Y.calculatedFee=I.calculatedFee,ne.feeDisabled=x.user,ne.calculatedFee=0}const Ae=se+ue+d[d.length-1].debt,je=C.gosposhlina(Ae+Y.enrichment,c);console.debug("Checkpoints after calculation",d);const Ee={debt:d[d.length-1].debt,debtBeforeTermination:Fe?ce:d[d.length-1].debt,percent:se,fee:ue,final:Ae,gosposhlina:{amount:je[0],formula:je[1]},courtType:c,enrichment:{formula:V`${Y.enrichment+Y.debt} - ${Y.debt}`,value:Y.enrichment},startDate:t,endDate:r,haltDate:a};let Re=[];return d.forEach(n=>{Re.push({Formula:n.formula,Percent:n.calculatedPercent,Fee:n.calculatedFee})}),Re.push({Formula:"Resulting Percent:",Percent:se,Fee:ue}),console.debug("[checkpoints, result]",[d,Ee]),[d,Ee]}var _e;let C=(_e=class{static datesInSpan(t,r,a){return t=t.map(l=>typeof l=="string"?new Date(l):l),t.filter(l=>l>=r&&l<a)}static lastRateChange(t,r){let[a,l]=[Object.keys(t),Object.values(t)];a=a.map(m=>new Date(m.split(","))),a.push(r),a.sort((m,f)=>m-f).reverse();const u=a.indexOf(r),c=l[kt(u+1,0,l.length-1)];return console.assert(!!c,"last rate change is falsy",r.toLocaleDateString("ru"),c),console.debug("Last rate change of",r.toLocaleDateString("ru"),"is",c,"index",u),c}static dateDiff(t,r,a){let l;switch(t){case"year":case"day":const u=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate()),c=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate());l=Math.floor((c-u)/(1e3*60*60*24))+1;break;case"week":l=Math.round((a-r)/6048e5);break;case"month":l=a.getMonth()-r.getMonth()+12*(a.getFullYear()-r.getFullYear());break;case"all":return 0;default:throw console.debug("state"),Error(`fuck off eslint ${t} ${r.toLocaleDateString("ru")??"date null"}`)}return console.assert(!!l||l>=0,"date diff is falsey",l,t,r==null?void 0:r.toLocaleDateString("ru"),a==null?void 0:a.toLocaleDateString("ru")),l}static addDays(t,r){let a=new Date(t);return a.setDate(a.getDate()+r),a}static isOneDayEvent(t){return["payment","charge"].includes(t)}},Be(_e,"gosposhlina",(t,r)=>{if(r===0)return t<=2e4?[Math.max(400,t*.04),t*.04<400?"Минимальная":`${t.toFixed(2)} * 0.04`]:t<=1e5?[800+(t-2e4)*.03,`800 + (${t.toFixed(2)} - 20000) x 0.03`]:t<=2e5?[3200+(t-1e5)*.02,`3200 + (${t.toFixed(2)} - 100000) x 0.02`]:t<=1e6?[5200+(t-2e5)*.01,`5200 + (${t.toFixed(2)} - 20000) x 0.01`]:[Math.min(6e4,13200+(t-1e6)*.005),13200+(t-1e6)*.005>6e4?"Максимальная":`13200 + (${t.toFixed(2)} - 1000000 x 0.005)`];if(r===1)return t<=1e5?[Math.max(2e3,t*.04),t*.04<2e3?"Минимальная":`2000, ${t.toFixed(2)} x 0.04`]:t<=2e5?[4e3+(t-1e5)*.03,`4000 + (${t.toFixed(2)} - 100000) x 0.03`]:t<=1e6?[7e3+(t-2e5)*.02,`7000 + (${t.toFixed(2)} - 200000) x 0.02`]:t<=2e6?[23e3+(t-1e6)*.01,`23000 + (${t.toFixed(2)} - 1000000) x 0.01`]:[Math.min(2e5,33e3+(t-2e6)*.005),33e3+(t-2e6)*.005<2e5?"Максимальная":`200000, 33200 + (${t.toFixed(2)} - 2000000) x 0.005`];throw Error(`Uh-oh ${r}`)}),_e);const W={"2022,8,19":7.5,"2022,6,25":8,"2022,5,14":9.5,"2022,4,27":11,"2022,4,4":14,"2022,3,11":17,"2022,1,28":20,"2022,1,14":9.5,"2021,11,20":8.5,"2021,9,25":7.5,"2021,8,13":6.75,"2021,6,26":6.5,"2021,5,15":5.5,"2021,3,26":5,"2021,2,22":4.5,"2020,6,27":4.25,"2020,5,22":4.5,"2020,3,27":5.5,"2020,1,10":6,"2019,11,16":6.25,"2019,9,28":6.5,"2019,8,9":7,"2019,6,29":7.25,"2019,5,17":7.5,"2018,11,17":7.75,"2018,8,17":7.5,"2018,2,26":7.25,"2018,1,12":7.5,"2017,11,18":7.75,"2017,9,30":8.25,"2017,8,18":8.5,"2017,5,19":9,"2017,4,2":9.25,"2017,2,27":9.75,"2016,8,19":10,"2016,5,14":10.5,"2015,7,3":11,"2015,5,16":11.5,"2015,4,5":12.5,"2015,2,16":14,"2015,1,2":15,"2014,11,16":17,"2014,11,12":10.5,"2014,10,5":9.5,"2014,6,28":8,"2014,3,28":7.5,"2014,2,3":7,"2013,8,13":5.5},x={no:0,yes:1,user:2};var $t=re("<div>"),xt=re("<tr><td colspan=2>Неосновательное обогащение:</td><td colspan=8>"),St=re("<div><table><thead><tr><th rowspan=2 colspan=1>Долг</th><th colspan=2>Период начисления</th><th colspan=2>Периоды</th><th colspan=2>Процент</th><th rowspan=2>Формула</th><th colspan=2>Начислено</th></tr><tr><th>с</th><th>по</th><th>%</th><th>неуст.</th><th>польз.</th><th>неуст.</th><th>процент</th><th>неустойка</th></tr></thead><tbody><tr><td colspan=7></td><td>Итого:</td><td></td><td></td></tr><tr><td colspan=2>Долг:</td><td colspan=8></td></tr><tr><td colspan=2></td><td colspan=8>"),Ct=re("<tr><td>. </td><td><br></td><td><br></td><td></td><td></td><td></td><td></td><td></td><td></td><td>");function Ht(){const[e]=xe(),t=()=>tt(e);$e(()=>{console.log("options generated",t(),r())});const r=()=>{const a=t();return"error"in a?null:et(a)};return s(Ke,{get when(){return r()},children:a=>s(Pt,{get checkpoints(){return a()[0]},get result(){return a()[1]}})})}function tt(e){var m;const t=new Date(e.document.date);if(isNaN(t.valueOf()))return{error:"startDate is invalid"};const r=_t(e.srokVozvrata,t);if(!r)return{error:"endDate is invalid"};const a=r>new Date?Vt(r,1):new Date;let l;{let f=e.fee;switch(f.type){case"fraction":case"money":l={amount:+f.sum,type:f.type==="fraction"?"percent":"money",period:f.periodUnit,disabled:!1};break;case"not-specified":+e.document.sum>1e5||e.zaimodavec.type==="ul"||e.zaemshik.type==="ul"?l={amount:0,type:"percent",period:"year",disabled:!1}:l={amount:0,type:"percent",period:"year",disabled:!0};break;case"bigger-than-loan":l={amount:0,returnMore:f.sum,type:"percent",period:"all",disabled:!0};break;case"no-fee":l={amount:0,type:"percent",period:"year",disabled:!0};break}}let u={amount:0,type:"percent",period:"year",disabled:!1,one300th:!1};//! option
{const f=e.penalty.value;switch(f.type){case"not-specified":case"central-bank":break;case"fraction":u.type="percent",u.period=f.periodUnit,u.amount=+f.sum;break;case"money":u.type="money",u.period=f.periodUnit,u.amount=+f.sum;break;case"no-penalty":u.disabled=!0;break}}const c=[];{const f=(p,D,$)=>{c.push({date:p,type:"payment",data:{amountIncrease:D,amountDecrease:$},rand:Math.random()})};if(e.proofs.returnProofs.type==="paid"){const p=D=>{for(let{date:$,sum:T}of D){const U=new Date($),d=+T;isNaN(d)||f(U,0,d)}};e.proofs.returnProofs.unbackedProofs&&p(e.proofs.returnProofs.unbackedProofs),e.proofs.returnProofs.zaemshikProofs&&p(e.proofs.returnProofs.zaemshikProofs),e.proofs.returnProofs.proofs&&p(e.proofs.returnProofs.proofs.filter(D=>"date"in D&&"sum"in D).map(D=>({date:D.date,sum:D.sum})))}let g=!1;for(const p of e.proofs.dogovorProofs)if(($=>"date"in $&&"sum"in $)(p))f(new Date(p.date),+p.sum,0);else if(p.type==="clause")g=!0,f(t,+e.document.sum,0);else if(p.type==="account-statement")for(const $ of p.loanTransactions)f(new Date($.date),+$.sum,0);!g&&e.document.type==="raspiska"&&f(t,+e.document.sum,0)}return{total:+e.document.sum,proofTotal:0,startDate:t,endDate:r,haltDate:a,percent:l,fee:u,feeLimited:{is:e.penalty.maxPenalty!==null,amount:e.penalty.maxPenalty===null?null:+e.penalty.maxPenalty,type:((m=e.penalty.maxPenalty)==null?void 0:m.type)??null},events:c,overrideFee:!1,court:Ce(e)==="sou"?1:0,returnMoreThanLoan:{is:!1,amount:0}}}function Pt(e){$e(()=>{console.log("table generated",{...e})});const[t,r]=pe(new Date().toISOString().split("T")[0]),[a,l]=pe(!1);return[(()=>{var u=$t();return w(u,s(Ue,{thin:!0,text:"Расчёт",onClick:()=>{}}),null),w(u,s(Ue,{thin:!0,text:"Документ",onClick:()=>{}}),null),he(()=>J(u,G["raschet-buttons"])),u})(),s(K,{question:"Демонстрация расчёта исковых требований",noPaddingTop:!0,get children(){var u=St(),c=u.firstChild,m=c.firstChild,f=m.nextSibling,g=f.firstChild,p=g.firstChild,D=p.nextSibling,$=D.nextSibling,T=$.nextSibling,U=g.nextSibling,d=U.firstChild,Q=d.nextSibling,P=U.nextSibling,z=P.firstChild,I=z.nextSibling;return w(f,s(dt,{get each(){return e.checkpoints},children:(v,A)=>s(Ft,{value:v,get i(){return A()}})}),g),w($,()=>be(e.result.percent)),w(T,()=>be(e.result.fee)),w(Q,()=>V`${e.result.debt+e.result.enrichment.value} + ${e.result.percent} + ${e.result.fee} = ${e.result.final+e.result.enrichment.value}`),w(z,()=>`Госпошлина (${["arb","sou"][e.result.courtType]}):`),w(I,()=>V`${e.result.gosposhlina.formula} = ${e.result.gosposhlina.amount}`),w(f,s(Ke,{get when(){return e.result.enrichment.value>=50},get children(){var v=xt(),A=v.firstChild,j=A.nextSibling;return w(j,()=>V`${e.result.enrichment.formula} = ${e.result.enrichment.value}`),he(()=>J(v,G.final)),v}}),null),he(v=>{var A=G["rounded-fix"],j=G["calculator-table"],R=G.total,Z=G.final,ie=G.final;return A!==v.e&&J(u,v.e=A),j!==v.t&&J(c,v.t=j),R!==v.a&&J(g,v.a=R),Z!==v.o&&J(U,v.o=Z),ie!==v.i&&J(P,v.i=ie),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),u}}),s(E,{type:"date",label:"Предполагаемая дата подачи иска",get value(){return t()},setValue:r}),s(Xe,{label:"Рассчитать неустойку по ставке ЦБ, в случае если размер неустойки слишком велик",get value(){return a()},setValue:l})]}function Ft(e){const t=()=>{let c=e.value,m=c.info.type;if(m==="payment"){let f=c;f.info.amountIncrease>=f.info.amountDecrease?m+="-increase":m+="-decrease"}return m},r=()=>{const c=e.value;return c.debt??c.enrichment??0},a=(c,m,f)=>c.info.oneDay?"":c.percentDisabled&&(m==="percent"||m==="percentPeriod")||c.feeDisabled&&(m==="fee"||m==="feePeriod")?"-":f,l=c=>{const m={percent:"%",money:"р."},f={day:"д",week:"н",month:"м",year:"г",all:"весь"};try{return`${c.amount}${m[c.type]}/${f[c.period]}`}catch{return"err"}},u=c=>c?c instanceof Date?c.toLocaleDateString("ru"):"not a date!":"date is null!";return(()=>{var c=Ct(),m=c.firstChild,f=m.firstChild,g=m.nextSibling,p=g.firstChild,D=g.nextSibling,$=D.firstChild,T=D.nextSibling,U=T.nextSibling,d=U.nextSibling,Q=d.nextSibling,P=Q.nextSibling,z=P.nextSibling,I=z.nextSibling;return w(m,()=>e.i,f),w(m,r,null),w(g,()=>u(e.value.from),p),w(D,()=>a(e.value,"to",u(e.value.to)),$),w(T,()=>a(e.value,"percentPeriod",e.value.percentPeriod)),w(U,()=>a(e.value,"feePeriod",e.value.feePeriod)),w(d,()=>a(e.value,"percent",l(e.value.percentData))),w(Q,()=>a(e.value,"fee",l(e.value.feeData))),w(P,()=>e.value.formula),w(z,()=>be(e.value.calculatedPercent)),w(I,()=>be(e.value.calculatedFee)),he(v=>{var A=t(),j=G.checkpoint;return A!==v.e&&ft(c,"data-type",v.e=A),j!==v.t&&J(c,v.t=j),v},{e:void 0,t:void 0}),c})()}function V(e,...t){return e.map(r=>{const a=t.shift();if(a===void 0)return r;if(a==0||typeof a!="number")return r+a;if(a){const l=a.toFixed(2);return+l.split(".")[1]>0?r+l:r+a}else return r}).join("")}function be(e){return e.toFixed(2)}function Vt(e,t){const r=new Date(e);return r.setDate(r.getDate()+t),r}var Mt={BASE_URL:"/zasudi-solid/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};function Tt(e){var r;(r=e.zaimodavec)==null||r.lastName;const t=tt(e);if("error"in t)console.log("court react no calculate",t);else{const a=et(t);if(a){const[,{final:l,enrichment:u}]=a,c=()=>"liquidation"in e.zaimodavec&&e.zaimodavec.liquidation!==null||"liquidation"in e.zaemshik&&e.zaemshik.liquidation!==null,m=zt(l,e.zaimodavec.type,c(),Ce(e),u.value>50),f=Se(m.initialScreen-1);return S(f)}else console.log("court react calculation fail",t,a)}return null}function zt(e,t,r,a,l=!1){let u=1,c="pretenzia";return a=="arb"&&!r?t==="ul"?e>8e5?(u=1,c="pretenzia"):e>5e5?(u=2,c="gppz"):l||(u=3,c="gppz"):t==="ip"&&(e>5e5?u=1:u=3):e>5e5?(u=5,c="gppz"):!l&&e>5e4?u=7:u=4,console.log("pick court type",e,t,r,a,l,u),{initialScreen:u,screenAfterCourt:c}}async function Ot(e){if(!It(e))return null;const t=(await ht(()=>import("./bd1-Dr5d7teW.js"),[])).default,r=await Nt(e);if(!r)return null;const a=r.kladr.slice(0,2);return t.find(l=>l.kladr.slice(0,2)===a)??null}async function Nt(e){let t=null;try{const r=await fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/findById/party",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Token "+Mt.VITE_DADATA},body:JSON.stringify({query:e})}).then(l=>(t=l.status,l)).then(l=>l.json());if(r.suggestions.length===0)return null;const a=r.suggestions[0];return{address:a.data.address,status:a.data.state.status,nameOpf:a.data.name.short_with_opf,name:a.data.name.full_with_opf,kladr:a.data.address.data.kladr_id,oktmo:a.data.address.data.oktmo,okato:a.data.address.data.okato,kpp:a.data.kpp,city_area:a.data.city_area}}catch(r){return console.error("queryINN error",r.toString(),"status",t),null}}function It(e){if(typeof e!="string"||e.length!==10&&e.length!==12||e.split("").some(t=>isNaN(Number(t))))return!1;if(e.length===10)return Number(e[9])===e.split("").slice(0,-1).reduce((t,r,a)=>[2,4,10,3,5,9,4,6,8][a]*Number(r)+t,0)%11%10;if(e.length===12){let t=e.split("").slice(0,-2).reduce((a,l,u)=>[7,2,4,10,3,5,9,4,6,8][u]*Number(l)+a,0)%11%10,r=e.split("").slice(0,-1).reduce((a,l,u)=>[3,7,2,4,10,3,5,9,4,6,8][u]*Number(l)+a,0)%11%10;return t===Number(e[10])&&r===Number(e[11])}return!1}var At=re("<div><pre>");const[me,jt]=pe(!1);function Se(e){let t;return e===2||e===6?t=S(new pt):t=S(new gt),t.type=["arb-claim","arb-simple","arb-order","jp-claim","gen-claim","gen-simple","jp-order"][e],t}function Et(e){return["arb-claim","arb-simple","arb-order","jp-claim","gen-claim","gen-simple","jp-order"].findIndex(t=>t===e.type)}function Rt(){const[e,t]=xe(),r=(u,c)=>{t("court",u,yt(c))},a=()=>Et(e.court),l=u=>{t("court",Se(u))};return(()=>{var u=At(),c=u.firstChild;return w(u,s(K,{get children(){return[s(ke,{get disabled(){return!me()},items:[{text:"1"},{text:"2"},{text:"3"},{text:"4"},{text:"5"},{text:"6"},{text:"7"}],get value(){return a()},setValue:m=>{function f(g){return g>=0&&g<=6}if(f(m))l(m);else throw new Error("Invalid court screen number")}}),s(Xe,{label:"Выбрать вручную",get value(){return me()},setValue:m=>{console.log(m,me()),jt(m)}})]}}),c),w(c,()=>JSON.stringify(e.court,null,2)),w(u,s(K,{get children(){return s(ge,{get children(){return[s(M,{get when(){return a()===0},get children(){return s(ae,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return a()===1},get children(){return s(ae,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return a()===2},get children(){return s(Ge,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return a()===3},get children(){return s(ae,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return a()===4},get children(){return s(ae,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return a()===5},get children(){return s(ae,{get value(){return e.court},setValue:r})}}),s(M,{get when(){return a()===6},get children(){return s(Ge,{get value(){return e.court},setValue:r})}})]}})}}),null),u})()}function ae(e){const t=()=>e.value.value,r=(a,l)=>{console.log("setting",S(e.value.value),a,l),e.setValue("value",{...e.value.value,[a]:l})};return s(We,{items:[{label:"Исковое заявление будет подано по месту жительства/нахождения должника (по умолчанию)",value:"default"},{label:"В договоре указан конкретный суд, в котором рассматриваются споры по договору",value:"specific"},{label:"Выбрать суд вручную",value:"manual"},{label:"В договоре укзаано, что дело рассматривается по месту нахождения/жительства истца",value:"zd-venue"},{label:"В договоре указано, что дело рассматривается по месту нахождения/жительства Займодавца",value:"za-venue"}],get value(){return e.value.value.type},setValue:a=>{switch(a){case"default":e.setValue("value",S(new we));break;case"specific":e.setValue("value",S(new He));break;case"manual":e.setValue("value",S(new ye));break;case"zd-venue":e.setValue("value",S(new Ze));break;case"za-venue":e.setValue("value",S(new Qe));break;default:throw new Error("Invalid court claim value")}},get children(){return s(nt,{get value(){return t()},setValue:r})}})}function Ge(e){const t=()=>e.value.value,r=(l,u)=>{e.setValue("value",{...e.value.value,[l]:u})},a=()=>e.value.value.type==="objections"||e.value.value.type==="rejected"||e.value.value.type==="cancelled"?"no-order":"order";return[s(We,{items:[{label:"Обратиться за вынесением судебного приказа",value:"order"},{label:"Я не могу обратиться за вынесением судебного приказа",value:"no-order"}],get value(){return a()},setValue:l=>{l==="order"?e.setValue("value",S(new we)):e.setValue("value",S(new Je))}}),s(K,{get children(){return s(ge,{get children(){return[s(M,{get when(){return a()==="order"},get children(){return[s(ke,{tallerRows:!0,items:[{text:"Исковое заявление будет подано по месту жительства/нахождения должника (по умолчанию)",value:"default"},{text:"В договоре указан конкретный суд, в котором рассматриваются споры по договору",value:"specific"},{text:"Выбрать суд вручную",value:"manual"},{text:"В договоре укзаано, что дело рассматривается по месту нахождения/жительства истца",value:"zd-venue"},{text:"В договоре указано, что дело рассматривается по месту нахождения/жительства Займодавца",value:"za-venue"}],get value(){return e.value.value.type},setValue:l=>{switch(l){case"default":e.setValue("value",S(new we));break;case"specific":e.setValue("value",S(new He));break;case"manual":e.setValue("value",S(new ye));break;case"zd-venue":e.setValue("value",S(new Ze));break;case"za-venue":e.setValue("value",S(new Qe));break;default:throw new Error("Invalid court claim (order) value")}}}),s(nt,{get value(){return t()},setValue:r})]}}),s(M,{get when(){return a()==="no-order"},get children(){return[s(ke,{tallerRows:!0,items:[{text:"У меня имеются письменные возражения заёмщика относительно спорной задолженности.",value:"objections"},{text:"Я уже обращался с заявлением о вынесении судебного приказа, однако Арбитражный суд вынес определение об отказе в принятии заявления о вынесении судебного приказа",value:"rejected"},{text:"Я уже обращался с заявлением о вынесении судебного приказа, однако судебный приказ был отменён в связи с подачей возражений должника.",value:"cancelled"}],get value(){return e.value.value.type},setValue:l=>{switch(l){case"objections":e.setValue("value",S(new Je));break;case"rejected":e.setValue("value",S(new vt));break;case"cancelled":e.setValue("value",S(new bt));break;default:throw new Error("Invalid court claim (no-order) value")}}}),s(ge,{get children(){return[s(M,{get when(){return e.value.value.type==="objections"},get children(){return[s(E,{label:"Наименование документа",get value(){return e.value.value.date},setValue:l=>r("name",l)}),s(E,{type:"date",label:"Дата документа",get value(){return e.value.value.date},setValue:l=>r("date",l)})]}}),s(M,{get when(){return e.value.value.type==="rejected"},get children(){return[s(E,{type:"date",label:"Дата определения об отказе в принятии заявления о вынесении судебного приказа",get value(){return e.value.value.date},setValue:l=>r("date",l)}),s(E,{label:"Номер дела из картотеки арбитражных дел",get value(){return e.value.value.date},setValue:l=>r("case",l)})]}}),s(M,{get when(){return e.value.value.type==="cancelled"},get children(){return[s(E,{type:"date",label:"Дата определения об отказе в принятии заявления о вынесении судебного приказа",get value(){return e.value.value.date},setValue:l=>r("date",l)}),s(E,{label:"Номер дела из картотеки арбитражных дел",get value(){return e.value.value.date},setValue:l=>r("case",l)})]}})]}})]}})]}})}})]}function nt(e){return s(ge,{get children(){return[s(M,{get when(){return e.value.type==="specific"},get children(){return s(K,{get children(){return[s(E,{label:"Наименование суда",get value(){return e.value.name},setValue:t=>e.setValue("name",t)}),s(E,{label:"Пункт договора",get value(){return e.value.clause},setValue:t=>e.setValue("clause",t)})]}})}}),s(M,{get when(){return e.value.type==="manual"},get children(){return s(K,{get children(){return s(E,{label:"Наименование суда",get value(){return e.value.name},setValue:t=>e.setValue("name",t)})}})}}),s(M,{get when(){return e.value.type==="zd-venue"},get children(){return s(K,{get children(){return s(E,{label:"Пункт договора",get value(){return e.value.clause},setValue:t=>e.setValue("clause",t)})}})}}),s(M,{get when(){return e.value.type==="za-venue"},get children(){return s(K,{get children(){return s(E,{label:"Пункт договора",get value(){return e.value.clause},setValue:t=>e.setValue("clause",t)})}})}})]}})}function Yt(e){const[t,r]=xe(),[a,l]=pe(null);return $e(mt(()=>e.currentCrumb,async()=>{const u=async()=>{if(t.zaimodavec.type!=="fl"&&t.zaemshik.type!=="fl"&&t.zaimodavec.type==="ul"){const g=t.zaimodavec.inn,p=a();if(p){console.log("court credentials memoized");const T=S(new ye);return T.name=p.credentials.court,T}const D=await Ot(g);if(console.log("picked court credentials",D),!D)return null;if(l({inn:g,credentials:D}),t.court.type.endsWith("order"))return console.error("court ends with order when bd1"),null;const $=S(new ye);return $.name=D.court,$}return null};let c=Dt(t.court);if(me()){console.log("court value overriden - not reacting");return}const m=Tt(t);m&&(c=m);const f=await u();f&&(c.value=f),r("court",c)})),null}function Ce(e){return e.zaemshik.type==="fl"||e.zaimodavec.type==="fl"||e.zaimodavec.type==="ip"&&e.zaimodavec.liquidation!==null||e.zaemshik.type==="ip"&&e.zaemshik.liquidation!==null?"sou":"arb"}const Xt=Object.freeze(Object.defineProperty({__proto__:null,CourtReactToFlow:Yt,courtType:Ce,default:Rt,generateCourtFromNumber:Se},Symbol.toStringTag,{value:"Module"}));export{Ht as C,Xt as a};
