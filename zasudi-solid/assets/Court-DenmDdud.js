var ft=Object.defineProperty;var ht=(e,t,a)=>t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var Be=(e,t,a)=>(ht(e,typeof t!="symbol"?t+"":t,a),a);import{k as we,l as u,S as Ke,h as De,i as _,c as he,a as U,F as mt,p as pt,t as re,C as pe,M,J as gt}from"./index-Wz2gLUeJ.js";import{Q as K,T as I}from"./TextField-7j08LMjo.js";import{D as ke}from"./DropdownSelect-B5gmsPAb.js";import{u as $e,B as Je,d as x,C as yt,A as bt,r as vt,E as Qe,G as Ze,H as xe,J as He,K as _e,O as Ue,Q as Dt,T as kt,a as _t}from"./DocumentFlow-EhlzY42N.js";import{C as Xe}from"./Checkbox-Cia6hiTD.js";import{calculateReturnDate as wt}from"./SrokVozvrata-B8AyF_v6.js";import{R as We}from"./RadioGroup-C78aaDIk.js";const G={"demo-name":"_demo-name_1ihfr_1","raschet-buttons":"_raschet-buttons_1ihfr_10","calculator-table":"_calculator-table_1ihfr_35","rounded-fix":"_rounded-fix_1ihfr_71","checkpoint-glow":"_checkpoint-glow_1ihfr_189","checkpoint-start":"_checkpoint-start_1ihfr_192","checkpoint-deadline":"_checkpoint-deadline_1ihfr_195","checkpoint-payment-decrease":"_checkpoint-payment-decrease_1ihfr_198","checkpoint-payment-increase":"_checkpoint-payment-increase_1ihfr_201","checkpoint-change":"_checkpoint-change_1ihfr_204","checkpoint-change-term":"_checkpoint-change-term_1ihfr_207","checkpoint-leapYear":"_checkpoint-leapYear_1ihfr_210","checkpoint-charge":"_checkpoint-charge_1ihfr_213","checkpoint-synthetic":"_checkpoint-synthetic_1ihfr_216","checkpoint-idk":"_checkpoint-idk_1ihfr_219"};function $t(e,t,a){return Math.max(t,Math.min(e,a))}function xt(e){return typeof e=="number"&&isNaN(e)&&e!==e}function et(e){var Ye,Le,qe;let{startDate:t,endDate:a,haltDate:r,feeLimited:l,events:s,court:c,overrideFee:m,returnMoreThanLoan:h}=e;//! If percent.amount is 0, then it is affected by rate changes, but
//! if percent.amount is "0", then it is actually just zero percent/period
const y={...e.percent},p={...e.fee};y.amount=y.amount||y.amount==0?+y.amount.toString().replace(",","."):null,p.amount=p.amount||p.amount==0?+p.amount.toString().replace(",","."):null,m&&(p.amount=0,p.type="percent",p.period="year");const w=(Ye=e.total)!=null&&Ye.replace?+e.total.replace(",","."):+e.total,C=(Le=e.proofTotal)!=null&&Le.replace?+e.proofTotal.replace(",","."):e.proofTotal;console.debug("totals",w,C,Math.min(w,C));const E=Math.min(w,C);if([E,t,a,r,Object.values(y),Object.values(p)].some(n=>n===null||n===""))return console.debug("Not enouugh data to calculate",Object.fromEntries(Object.entries({total:E,startDate:t,endDate:a,haltDate:r,percent:y,fee:p}).filter(([n,i])=>i===null||i===""))),null;const J=["debt","to","percentPeriod","feePeriod","percentData","feeData","percentDisabled","feeDisabled","formula","calculatedPercent","calculatedFee"];let d=null;const Q=(n,i)=>{try{const o=n.indexOf(n.slice(i+1).find(g=>!g.info.oneDay));return console.assert(o>0,"next multiple day checkpoint index is <= 0",o,i),n[o]}catch(o){throw console.debug(n,i,n.slice(i+1)),o}},P=class{constructor(n,i,o={}){this.from=i,this.terminated=o.terminated??!1,this.enrichment=0,this.info={...o,type:n},this.info.oneDay=S.isOneDayEvent(this.info.type),J.forEach(g=>this[g]=null)}daysInYear(){const n=this.from.getFullYear();return n%400===0||n%100!==0&&n%4===0?366:365}startSpecial({total:n,calculatorData:i,nextCheckpoint:o,returnMore:g}){this.debt=n,this.to=o.info.type==="deadline"?S.addDays(o.from,-1):o.from,this.percentPeriod=S.dateDiff(i.percent.period,this.from,this.to),this.feePeriod=S.dateDiff(i.fee.period,this.from,this.to);const D=S.lastRateChange(W,this.from),F=y.amount===0&&!g.is;console.assert(!!D,"lastRateChange is falsey",D),console.assert(!!y.amount||y.amount===0,"percent.amount is falsey",y.amount),this.percentData={amount:F?D:y.amount,type:y.type,period:y.period,rateAffected:F};const H=p.amount===0;this.feeData={amount:H?D:p.amount,type:p.type,period:p.period,rateAffected:H,one300th:p.one300th},this.percentDisabled=i.percent.disabled?$.user:$.no,this.feeDisabled=i.fee.disabled?$.user:$.yes}firstStage({previousCheckpoint:n,nextCheckpoint:i,index:o}){this.from<t||(this.debt=n.debt,this.enrichment=n.enrichment,this.info.type==="deadline"&&n.percentData.period==="all"?this.to=a:i.info.type==="payment"?i.info.amountIncrease-i.info.amountDecrease>0?this.to=this.info.oneDay?null:S.addDays(i.from,-1):this.to=this.info.oneDay?null:i.from:i.info.type==="halt"?this.to=this.info.oneDay?null:i.from:this.to=this.info.oneDay?null:S.addDays(i.from,-1),this.percentPeriod=n.percentPeriod,this.feePeriod=n.feePeriod,this.percentData={...n.percentData},this.feeData={...n.feeData},this.percentDisabled=n.percentDisabled,this.feeDisabled=n.feeDisabled,n.info.type==="deadline"&&(n.percentData.period==="all"&&(this.percentDisabled=$.user),n.feeData.period==="all"&&(this.feeDisabled=$.user)),(n.terminated||this.terminated)&&(this.terminated=!0,n.terminated||(this.debt+=te.percent(o)),this.percentDisabled=$.user,this.feeData.period="year",this.feeData.type="percent",this.info.type==="rate"?this.feeData.amount=this.info.rate:this.feeData.amount=S.lastRateChange(W,this.from)))}secondStage({previousCheckpoint:n}){this.info.type==="change"&&(this.info.percentAmount!==null&&(this.percentData.type=this.info.percentType,this.percentData.period=this.info.percentPeriod,this.percentData.amount=this.info.percentAmount,this.percentData.rateAffected=!1),this.info.feeAmount!==null&&(this.feeData.type=this.info.feeType,this.feeData.period=this.info.feePeriod,this.feeData.amount=this.info.feeAmount,this.feeData.rateAffected=!1),this.terminated||(this.percentDisabled=this.info.percentDisabled?$.user:$.no),this.feeDisabled=this.feeDisabled===$.user?$.user:this.info.feeDisabled?$.yes:$.no),this.info.oneDay?this.percentPeriod=this.feePeriod=null:(this.percentPeriod=S.dateDiff(this.percentData.period,this.from,this.to),this.info.type==="synthetic"&&console.debug("period",this.percentData.period,this.from,this.to,this.percentPeriod),this.feePeriod=S.dateDiff(this.feeData.period,this.from,this.to));const i=()=>{this.percentData&&this.percentData.period==="all"&&n.info.type==="deadline"&&(this.feeDisabled=$.no,console.debug("fee enabled"))};switch(this.info.type){case"deadline":this.feeDisabled!==$.user&&this.percentData.period!=="all"?(this.feeDisabled=$.no,this.feeData.rateAffected&&(this.feeData.amount=S.lastRateChange(W,this.from),console.debug("fee enabled",this.feeData.amount,this.from))):console.debug("fee not enabled");break;case"rate":console.assert(typeof this.info.rate=="number"),this.percentData.rateAffected&&(this.percentData.amount=this.info.rate),this.feeData.rateAffected&&(this.feeData.amount=this.info.rate),i();break;default:i();break}}thirdStage(n,i){let[o,g]=[0,0],[D,F]=["",""];const H=(T,k,b,L)=>{let q="nothing";console.assert(!Object.entries(b).some(([de,fe])=>(q=de,xt(fe)||fe!==0&&typeof fe!="boolean"&&!fe)),"Checkpoint data nan or falsy",q,this.info,b);let N,B="";if(b.period==="year")if(b.type==="percent"){const de=b.one300th?300:this.daysInYear();N=T*(k/de)*(b.amount/100),B=V`${T} x ${k} / ${de} x ${b.amount}%`}else N=0,B="";else b.period==="all"?L!=="deadline"?(N=0,B="amogus"):b.type==="percent"?(N=T*(b.amount/100),B=V`${T} x ${b.amount}%`):(N=b.amount,B=V`${b.amount}`):b.type==="percent"?(N=T*k*(b.amount/100),B=V`${T} x ${k} x ${b.amount}%`):(N=b.amount*k,B=V`${b.amount} x ${k}`);return[N,B]};switch(this.info.type){default:if(this.info.type==="change"&&this.info.terminated){const k=te.percent(n);D+=V`${this.debt-k} + ${k} = ${this.debt}; `}if(this.percentDisabled===$.no){const[k,b]=H(this.debt,this.percentPeriod,this.percentData,this.info.type);this.info.type==="deadline"&&h.is?(o=h.amount-w,D=`${w} - ${h.amount}`):(o=k,D=b)}if(this.feeDisabled===$.no){let[k,b]=H(this.debt,this.feePeriod,this.feeData,this.info.type);if(l.is){let L;l.type==="percent"?L=E*(l.amount/100):L=l.amount,console.assert(L!==void 0,"feeLimited type is not percent or money",l);const q=te.fee(n);q+k>L&&(k=L-q,this.feeDisabled=$.user)}g=k,F=b}if(console.debug("percent.returnMore",e.percent.returnMore),e.percent.returnMore&&this.info.type==="deadline"){const k=+e.percent.returnMore;isNaN(k)&&console.error("return more is nan"),o=k-this.debt,D=V`${k} - ${this.debt}`}break;case"charge":this.info.amountPercent>0&&(o=+this.info.amountPercent,D=V`+${o}`),this.info.amountFee>0&&(g=+this.info.amountFee,F=V`${this.info.amountPercent===0?"+":""}${g}`);break;case"payment":const T=(this.info.amountIncrease??0)-+(this.info.amountDecrease??0);if(T>=0){const k=this.debt+T,b=Math.min(w,k);D=V`${this.debt} + ${T} = ${k}`,this.debt=b,this.enrichment+=k-b,console.assert(k>=b,"added enrichment cant be negative buddy")}else{const k=(N,B)=>[Math.max(N-B,0),Math.abs(Math.min(N-B,0))],b=te.percent(n);console.assert(b>=0,"prior sum is negative for some reason",b);const[L,q]=k(b,Math.abs(T));if(console.assert(L>=0,"im pretty sure percent can't be negative here",L),console.assert(q>=0,"remainder can't be negative as well",q),q<=0)D=V`${b} - ${Math.abs(T)} = ${L}`,o=-Math.abs(T),g=0;else{o=-b,D=V`${b} - ${Math.abs(T)} = -${q}`,this.enrichment,this.enrichment-=q;const N=this.enrichment;N<0&&(this.debt+=N,this.enrichment=0)}}break}const X=D!==""&&F!==""?" + ":" ";this.debt=Math.round(this.debt*100)/100,this.formula=`${D}${X}${F}`,this.calculatedPercent=o,this.calculatedFee=g}};let z=new P("start",t),j,v;y.period==="all"?v=new Date(t.getTime()+1e3):v=S.addDays(a,1),j=new P("deadline",v),v>r&&(r=S.addDays(v,1));const A=new P("halt",r);console.debug("endhalt",a,r);const O=s.map(n=>new P(n.type,n.date,n.data));let R=O.sort((n,i)=>n.from-i.from).filter(n=>n.info.type==="change").map(n=>({percent:{period:n.info.percentPeriod,type:n.info.percentType,amount:n.info.percentAmount},fee:{period:n.info.feePeriod,type:n.info.feeType,amount:n.info.feeAmount},date:n.from}));R=[{percent:y,fee:p},...R,{fee:{period:"year",type:"percent"},percent:{period:"year",type:"percent"},date:new Date(new Date().getTime()*1.15)}];const Z={__shared:(n,i)=>{for(let o=0;o<R.length;o++)if(R[o].date>=n&&R[o-1])return R[o-1][i];return R[R.length-1][i]},percent:n=>Z.__shared(n,"percent"),fee:n=>Z.__shared(n,"fee")},ie=(n,i)=>{let o=i.getFullYear()-n.getFullYear();return(n.getMonth()>i.getMonth()||n.getMonth()===i.getMonth()&&n.getDate()>i.getDate())&&o--,o};{let n=ie(t,r),i=0;do{const o=new Date(t.getFullYear()+ ++i,t.getMonth(),t.getDate()),g=Z.percent(o),D=Z.fee(o),F=(X=>X.period==="year"&&X.type==="money")(g),H=(X=>X.period==="year"&&X.type==="money")(D);(F||H)&&n!==0&&O.push(new P("charge",o,{amountFee:D.amount,amountPercent:g.amount,yearlyCharge:!0}))}while(--n>0)}const Pe=n=>{const i=[],o=F=>F%400===0||F%100!==0&&F%4===0?366:365;let g=o(t.getFullYear()),D=new Date(n);console.debug("halt",r);do{if(D.setYear(D.getFullYear()+1),o(D.getFullYear())!==g&&D<r){const F=new Date(D.getFullYear(),0,1);F.toLocaleDateString("ru")!==a.toLocaleDateString("ru")&&i.push(new P("leapYear",F))}g=o(D.getFullYear())}while(D<r);return i};//! First weird decision
const ye=s.filter(n=>n.type==="change"&&n.data.terminated);console.assert(ye.length<=1,"more than one termination change event present",s);const Fe=ye.length===1,Ve=(qe=ye[0])==null?void 0:qe.date,Me=n=>n.map(i=>{const o=`${i.getFullYear()},${i.getMonth()},${i.getDate()}`;return console.assert(W[o]!==void 0,"fee rate at date is falsey",W[o],o),new P("rate",i,{terminated:Fe&&Ve&&i.getTime()>=Ve.getTime(),rate:W[o]})});let be;y.amount===0?be="cb":be=y.period;let le;p.one300th?le="1_300":p.amount===0?le="cb":le=p.period;let ze=Object.keys(W).map(n=>new Date(...n.split(","))),lt=Me(S.datesInSpan(ze,t,r)),Te=Me(S.datesInSpan(ze,a,r)),ot=Pe(t),st=Pe(a);const f=(n,i)=>({rate:n,leap:i}),ut={day:{day:f("no","no"),week:f("no","no"),month:f("no","no"),year:f("no","deadline"),cb:f("deadline","deadline"),"1_300":f("deadline","no"),all:f("no","no")},week:{day:f("no","no"),week:f("no","no"),month:f("no","no"),year:f("no","deadline"),cb:f("deadline","deadline"),"1_300":f("deadline","no"),all:f("no","no")},month:{day:f("no","no"),week:f("no","no"),month:f("no","no"),year:f("no","deadline"),cb:f("deadline","deadline"),"1_300":f("deadline","no"),all:f("no","no")},year:{day:f("no","yes"),week:f("no","yes"),month:f("no","yes"),year:f("no","yes"),cb:f("deadline","yes"),"1_300":f("deadline","yes"),all:f("no","yes")},cb:{day:f("yes","yes"),week:f("yes","yes"),month:f("yes","yes"),year:f("yes","yes"),cb:f("yes","yes"),"1_300":f("yes","yes"),all:f("yes","yes")},all:{day:f("no","no"),week:f("no","no"),month:f("no","no"),year:f("no","deadline"),cb:f("deadline","deadline"),"1_300":f("deadline","no"),all:f("no","no")}},Ne=(n,i,o)=>{try{switch(ut[be][le][n]){case"no":return[];case"yes":return i;case"deadline":return o}}catch(g){throw g}};let ee=Ne("rate",lt,Te),ct=Ne("leap",ot,st);if(ee==Te&&ee.length>0){const n=ee[0];n.from=a}console.debug({rateChangeCheckpoints:ee}),d=[z,...j===void 0?[]:[j],...ee,...O,...ct,A].sort((n,i)=>n.from-i.from),d.forEach((n,i)=>{if(n===void 0)throw console.debug("Checkpoint can't be undefined dummy",i,d,{start:z,deadline:j,rateChangeCheckpoints:ee,eventCheckpoints:O,halt:A}),Error("Checkpoint can't be undefined dummy")});for(let n=0;n<d.length;n++){const i=d[n];//! 01.01.2020 | 31.12.2019 | ... synthetic
i.info.type!=="synthetic"&&i.info.oneDay&&!i.info.yearlyCharge&&i.from>=t&&(i.info.type==="payment"?i.info.amountIncrease-i.info.amountDecrease>0?d.splice(n+1,0,new P("synthetic",i.from)):d.splice(n+1,0,new P("synthetic",S.addDays(i.from,1))):d.splice(n+1,0,new P("synthetic",S.addDays(i.from,1))))}//! use only in third stage
const te={__shared:(n,i)=>{if(n<=0)return console.warn("probably shouldn't happen"),0;let o=0;for(let g=0;g<n;g++)console.assert(typeof d[g][i]=="number","sumprior prop isn't a number",d[n][i]),o+=d[g][i];return o},percent:n=>te.__shared(n,"calculatedPercent"),fee:n=>te.__shared(n,"calculatedFee")},je=JSON.parse(JSON.stringify(d));console.debug("Checkpoints before calculation",je),console.debug(je.map(n=>[n.info.type,new Date(n.from)]));const Ae=Q(d,d.findIndex(n=>n.info.type==="start"));z.startSpecial({total:E,calculatorData:e,nextCheckpoint:Ae,returnMore:h}),z.secondStage({previousCheckpoint:z}),z.thirdStage(0,Ae);//! cringe but i can't think of a better solution that won't take forever
const oe=d.findIndex(n=>n.info.type==="start");if(oe!==0){const n=d.slice(0,oe);console.debug("checkps before start"),n[0].debt=0;for(let i=0;i<oe;i++){const o=n[i];switch(o.info.type){case"payment":o.thirdStage(i),z.debt+=o.debt,z.enrichment=o.enrichment,console.debug("b4",i,o.info.type,o.info,o.calculatedFee,o.calculatedPercent,o.enrichment);break;default:throw console.error("chk",o,d),Error("only payment before start is supported "+o.info.type)}}}for(let n=oe+1;n<d.length-1;n++){const i=d[n];let o=Q(d,n);o.info.type==="halt"&&(o=d[n+1]);try{i.firstStage({previousCheckpoint:d[n-1],nextCheckpoint:d[n+1],index:n})}catch(g){throw console.debug("Error in stage 1: ",g),console.debug(i,d[n-1],o),g}try{i.secondStage({previousCheckpoint:d[n-1]})}catch(g){throw console.debug("Error in stage 2: ",g),console.debug(i),g}try{i.thirdStage(n,o)}catch(g){throw console.debug("Error in stage 3: ",g),console.debug(i,o),g}}//! Remove 'halt'
//! removes deadline under certain circumstances lol
d.at(-1).info.type==="deadline"&&console.debug("crashed",d.at(-1)),d=d.filter(n=>n.info.type!=="halt");let Y=d[d.length-1],ne,[se,ue,dt,ce]=[0,0,0,null];console.debug("checkpoints",d.map(n=>n.info.type));for(let n=0;n<d.length;n++){const i=d[n];i.info.type==="change"&&i.info.terminated&&(ce=d[n-1].debt),se+=i.calculatedPercent,ue+=i.calculatedFee,i.info.type==="payment"&&(dt+=i.info.amountDecrease-i.info.amountIncrease),i.info.type==="deadline"&&(ne=i)}ce===null&&(ce=Y.debt);//! cringe
if(ne.feeData.period==="all"&&ne.percentData.period!=="all"){const[n,i]=ne.formula.split(" + ");Y.formula+=" + "+i,j.formula=n,Y.feePeriod=j.feePeriod,Y.feeData={...j.feeData},Y.feeDisabled=$.no,Y.calculatedFee=j.calculatedFee,ne.feeDisabled=$.user,ne.calculatedFee=0}const Oe=se+ue+d[d.length-1].debt,Ie=S.gosposhlina(Oe+Y.enrichment,c);console.debug("Checkpoints after calculation",d);const Ee={debt:d[d.length-1].debt,debtBeforeTermination:Fe?ce:d[d.length-1].debt,percent:se,fee:ue,final:Oe,gosposhlina:{amount:Ie[0],formula:Ie[1]},courtType:c,enrichment:{formula:V`${Y.enrichment+Y.debt} - ${Y.debt}`,value:Y.enrichment},startDate:t,endDate:a,haltDate:r};let Re=[];return d.forEach(n=>{Re.push({Formula:n.formula,Percent:n.calculatedPercent,Fee:n.calculatedFee})}),Re.push({Formula:"Resulting Percent:",Percent:se,Fee:ue}),console.debug("[checkpoints, result]",[d,Ee]),[d,Ee]}var ve;let S=(ve=class{static datesInSpan(t,a,r){return t=t.map(l=>typeof l=="string"?new Date(l):l),t.filter(l=>l>=a&&l<r)}static lastRateChange(t,a){let[r,l]=[Object.keys(t),Object.values(t)];r=r.map(m=>new Date(m.split(","))),r.push(a),r.sort((m,h)=>m-h).reverse();const s=r.indexOf(a),c=l[$t(s+1,0,l.length-1)];return console.assert(!!c,"last rate change is falsy",a.toLocaleDateString("ru"),c),console.debug("Last rate change of",a.toLocaleDateString("ru"),"is",c,"index",s),c}static dateDiff(t,a,r){let l;switch(t){case"year":case"day":const s=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),c=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate());l=Math.floor((c-s)/(1e3*60*60*24))+1;break;case"week":l=Math.round((r-a)/6048e5);break;case"month":l=r.getMonth()-a.getMonth()+12*(r.getFullYear()-a.getFullYear());break;case"all":return 0;default:throw console.debug("state"),Error(`fuck off eslint ${t} ${a.toLocaleDateString("ru")??"date null"}`)}return console.assert(!!l||l>=0,"date diff is falsey",l,t,a==null?void 0:a.toLocaleDateString("ru"),r==null?void 0:r.toLocaleDateString("ru")),l}static addDays(t,a){let r=new Date(t);return r.setDate(r.getDate()+a),r}static isOneDayEvent(t){return["payment","charge"].includes(t)}},Be(ve,"gosposhlina",(t,a)=>{if(a===0)return t<=2e4?[Math.max(400,t*.04),t*.04<400?"Минимальная":`${t.toFixed(2)} * 0.04`]:t<=1e5?[800+(t-2e4)*.03,`800 + (${t.toFixed(2)} - 20000) x 0.03`]:t<=2e5?[3200+(t-1e5)*.02,`3200 + (${t.toFixed(2)} - 100000) x 0.02`]:t<=1e6?[5200+(t-2e5)*.01,`5200 + (${t.toFixed(2)} - 20000) x 0.01`]:[Math.min(6e4,13200+(t-1e6)*.005),13200+(t-1e6)*.005>6e4?"Максимальная":`13200 + (${t.toFixed(2)} - 1000000 x 0.005)`];if(a===1)return t<=1e5?[Math.max(2e3,t*.04),t*.04<2e3?"Минимальная":`2000, ${t.toFixed(2)} x 0.04`]:t<=2e5?[4e3+(t-1e5)*.03,`4000 + (${t.toFixed(2)} - 100000) x 0.03`]:t<=1e6?[7e3+(t-2e5)*.02,`7000 + (${t.toFixed(2)} - 200000) x 0.02`]:t<=2e6?[23e3+(t-1e6)*.01,`23000 + (${t.toFixed(2)} - 1000000) x 0.01`]:[Math.min(2e5,33e3+(t-2e6)*.005),33e3+(t-2e6)*.005<2e5?"Максимальная":`200000, 33200 + (${t.toFixed(2)} - 2000000) x 0.005`];throw Error(`Uh-oh ${a}`)}),ve);const W={"2022,8,19":7.5,"2022,6,25":8,"2022,5,14":9.5,"2022,4,27":11,"2022,4,4":14,"2022,3,11":17,"2022,1,28":20,"2022,1,14":9.5,"2021,11,20":8.5,"2021,9,25":7.5,"2021,8,13":6.75,"2021,6,26":6.5,"2021,5,15":5.5,"2021,3,26":5,"2021,2,22":4.5,"2020,6,27":4.25,"2020,5,22":4.5,"2020,3,27":5.5,"2020,1,10":6,"2019,11,16":6.25,"2019,9,28":6.5,"2019,8,9":7,"2019,6,29":7.25,"2019,5,17":7.5,"2018,11,17":7.75,"2018,8,17":7.5,"2018,2,26":7.25,"2018,1,12":7.5,"2017,11,18":7.75,"2017,9,30":8.25,"2017,8,18":8.5,"2017,5,19":9,"2017,4,2":9.25,"2017,2,27":9.75,"2016,8,19":10,"2016,5,14":10.5,"2015,7,3":11,"2015,5,16":11.5,"2015,4,5":12.5,"2015,2,16":14,"2015,1,2":15,"2014,11,16":17,"2014,11,12":10.5,"2014,10,5":9.5,"2014,6,28":8,"2014,3,28":7.5,"2014,2,3":7,"2013,8,13":5.5},$={no:0,yes:1,user:2};var Ct=re("<div>"),St=re("<tr><td colspan=2>Неосновательное обогащение:</td><td colspan=8>"),Pt=re("<div><table><thead><tr><th rowspan=2 colspan=1>Долг</th><th colspan=2>Период начисления</th><th colspan=2>Периоды</th><th colspan=2>Процент</th><th rowspan=2>Формула</th><th colspan=2>Начислено</th></tr><tr><th>с</th><th>по</th><th>%</th><th>неуст.</th><th>польз.</th><th>неуст.</th><th>процент</th><th>неустойка</th></tr></thead><tbody><tr><td colspan=7></td><td>Итого:</td><td></td><td></td></tr><tr><td colspan=2>Долг:</td><td colspan=8></td></tr><tr><td colspan=2></td><td colspan=8>"),Ft=re("<tr><td>. </td><td><br></td><td><br></td><td></td><td></td><td></td><td></td><td></td><td></td><td>");function en(){const[e]=$e(),t=()=>tt(e);we(()=>{console.log("options generated",t(),a())});const a=()=>{const r=t();return"error"in r?null:et(r)};return u(Ke,{get when(){return a()},children:r=>u(Vt,{get checkpoints(){return r()[0]},get result(){return r()[1]}})})}function tt(e){var m;const t=new Date(e.document.date);if(isNaN(t.valueOf()))return{error:"startDate is invalid"};const a=wt(e.srokVozvrata,t);if(!a)return{error:"endDate is invalid"};const r=a>new Date?zt(a,1):new Date;let l;{let h=e.fee;switch(h.type){case"fraction":case"money":l={amount:+h.sum,type:h.type==="fraction"?"percent":"money",period:h.periodUnit,disabled:!1};break;case"not-specified":+e.document.sum>1e5||e.zaimodavec.type==="ul"||e.zaemshik.type==="ul"?l={amount:0,type:"percent",period:"year",disabled:!1}:l={amount:0,type:"percent",period:"year",disabled:!0};break;case"bigger-than-loan":l={amount:0,returnMore:h.sum,type:"percent",period:"all",disabled:!0};break;case"no-fee":l={amount:0,type:"percent",period:"year",disabled:!0};break}}let s={amount:0,type:"percent",period:"year",disabled:!1,one300th:!1};//! option
{const h=e.penalty.value;switch(h.type){case"not-specified":case"central-bank":break;case"fraction":s.type="percent",s.period=h.periodUnit,s.amount=+h.sum;break;case"money":s.type="money",s.period=h.periodUnit,s.amount=+h.sum;break;case"no-penalty":s.disabled=!0;break}}const c=[];{const h=(p,w,C)=>{c.push({date:p,type:"payment",data:{amountIncrease:w,amountDecrease:C},rand:Math.random()})};if(e.proofs.returnProofs.type==="paid"){const p=w=>{for(let{date:C,sum:E}of w){const J=new Date(C),d=+E;isNaN(d)||h(J,0,d)}};e.proofs.returnProofs.unbackedProofs&&p(e.proofs.returnProofs.unbackedProofs),e.proofs.returnProofs.zaemshikProofs&&p(e.proofs.returnProofs.zaemshikProofs),e.proofs.returnProofs.proofs&&p(e.proofs.returnProofs.proofs.filter(w=>"date"in w&&"sum"in w).map(w=>({date:w.date,sum:w.sum})))}let y=!1;for(const p of e.proofs.dogovorProofs)if((C=>"date"in C&&"sum"in C)(p))h(new Date(p.date),+p.sum,0);else if(p.type==="clause")y=!0,h(t,+e.document.sum,0);else if(p.type==="account-statement")for(const C of p.loanTransactions)h(new Date(C.date),+C.sum,0);!y&&e.document.type==="raspiska"&&h(t,+e.document.sum,0)}return{total:+e.document.sum,proofTotal:0,startDate:t,endDate:a,haltDate:r,percent:l,fee:s,feeLimited:{is:e.penalty.maxPenalty!==null,amount:e.penalty.maxPenalty===null?null:+e.penalty.maxPenalty,type:((m=e.penalty.maxPenalty)==null?void 0:m.type)??null},events:c,overrideFee:!1,court:Se(e)==="sou"?1:0,returnMoreThanLoan:{is:!1,amount:0}}}function Vt(e){we(()=>{console.log("table generated",{...e})});const[t,a]=De(new Date().toISOString().split("T")[0]),[r,l]=De(!1);return[(()=>{var s=Ct();return _(s,u(Je,{thin:!0,text:"Расчёт",onClick:()=>{}}),null),_(s,u(Je,{thin:!0,text:"Документ",onClick:()=>{}}),null),he(()=>U(s,G["raschet-buttons"])),s})(),u(K,{question:"Демонстрация расчёта исковых требований",noPaddingTop:!0,get children(){var s=Pt(),c=s.firstChild,m=c.firstChild,h=m.nextSibling,y=h.firstChild,p=y.firstChild,w=p.nextSibling,C=w.nextSibling,E=C.nextSibling,J=y.nextSibling,d=J.firstChild,Q=d.nextSibling,P=J.nextSibling,z=P.firstChild,j=z.nextSibling;return _(h,u(mt,{get each(){return e.checkpoints},children:(v,A)=>u(Mt,{value:v,get i(){return A()}})}),y),_(C,()=>ge(e.result.percent)),_(E,()=>ge(e.result.fee)),_(Q,()=>V`${e.result.debt+e.result.enrichment.value} + ${e.result.percent} + ${e.result.fee} = ${e.result.final+e.result.enrichment.value}`),_(z,()=>`Госпошлина (${["arb","sou"][e.result.courtType]}):`),_(j,()=>V`${e.result.gosposhlina.formula} = ${e.result.gosposhlina.amount}`),_(h,u(Ke,{get when(){return e.result.enrichment.value>=50},get children(){var v=St(),A=v.firstChild,O=A.nextSibling;return _(O,()=>V`${e.result.enrichment.formula} = ${e.result.enrichment.value}`),he(()=>U(v,G.final)),v}}),null),he(v=>{var A=G["rounded-fix"],O=G["calculator-table"],R=G.total,Z=G.final,ie=G.final;return A!==v.e&&U(s,v.e=A),O!==v.t&&U(c,v.t=O),R!==v.a&&U(y,v.a=R),Z!==v.o&&U(J,v.o=Z),ie!==v.i&&U(P,v.i=ie),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s}}),u(I,{type:"date",label:"Предполагаемая дата подачи иска",get value(){return t()},setValue:a}),u(Xe,{label:"Рассчитать неустойку по ставке ЦБ, в случае если размер неустойки слишком велик",get value(){return r()},setValue:l})]}function Mt(e){const t=()=>{let c=e.value,m=c.info.type;if(m==="payment"){let h=c;h.info.amountIncrease>=h.info.amountDecrease?m+="-increase":m+="-decrease"}return m},a=()=>{const c=e.value;return c.debt??c.enrichment??0},r=(c,m,h)=>c.info.oneDay?"":c.percentDisabled&&(m==="percent"||m==="percentPeriod")||c.feeDisabled&&(m==="fee"||m==="feePeriod")?"-":h,l=c=>{const m={percent:"%",money:"р."},h={day:"д",week:"н",month:"м",year:"г",all:"весь"};try{return`${c.amount}${m[c.type]}/${h[c.period]}`}catch{return"err"}},s=c=>c?c instanceof Date?c.toLocaleDateString("ru"):"not a date!":"date is null!";return(()=>{var c=Ft(),m=c.firstChild,h=m.firstChild,y=m.nextSibling,p=y.firstChild,w=y.nextSibling,C=w.firstChild,E=w.nextSibling,J=E.nextSibling,d=J.nextSibling,Q=d.nextSibling,P=Q.nextSibling,z=P.nextSibling,j=z.nextSibling;return _(m,()=>e.i,h),_(m,a,null),_(y,()=>s(e.value.from),p),_(w,()=>r(e.value,"to",s(e.value.to)),C),_(E,()=>r(e.value,"percentPeriod",e.value.percentPeriod)),_(J,()=>r(e.value,"feePeriod",e.value.feePeriod)),_(d,()=>r(e.value,"percent",l(e.value.percentData))),_(Q,()=>r(e.value,"fee",l(e.value.feeData))),_(P,()=>e.value.formula),_(z,()=>ge(e.value.calculatedPercent)),_(j,()=>ge(e.value.calculatedFee)),he(v=>{var A=t(),O=G.checkpoint;return A!==v.e&&pt(c,"data-type",v.e=A),O!==v.t&&U(c,v.t=O),v},{e:void 0,t:void 0}),c})()}function V(e,...t){return e.map(a=>{const r=t.shift();if(r===void 0)return a;if(r==0||typeof r!="number")return a+r;if(r){const l=r.toFixed(2);return+l.split(".")[1]>0?a+l:a+r}else return a}).join("")}function ge(e){return e.toFixed(2)}function zt(e,t){const a=new Date(e);return a.setDate(a.getDate()+t),a}function nt(e){let t=new Map;const a=r=>r.map(l=>JSON.stringify(l)).join("_");return async function(...r){const l=a(r),s=t.get(l);if(s!==void 0)return console.log("memoized",l,s),s;{const c=await e(...r);return console.log("not memoized",{key:l,val:c}),t.set(l,c),c}}}function Tt(e){var a;(a=e.zaimodavec)==null||a.lastName;const t=tt(e);if("error"in t)console.log("court react no calculate",t);else{const r=et(t);if(r){const[,{final:l,enrichment:s}]=r,c=()=>"liquidation"in e.zaimodavec&&e.zaimodavec.liquidation!==null||"liquidation"in e.zaemshik&&e.zaemshik.liquidation!==null,m=Nt(l,e.zaimodavec.type,c(),Se(e),s.value>50),h=Ce(m.initialScreen-1);return x(h)}else console.log("court react calculation fail",t,r)}return null}function Nt(e,t,a,r,l=!1){let s=1,c="pretenzia";return r=="arb"&&!a?t==="ul"?e>8e5?(s=1,c="pretenzia"):e>5e5?(s=2,c="gppz"):l||(s=3,c="gppz"):t==="ip"&&(e>5e5?s=1:s=3):e>5e5?(s=5,c="gppz"):!l&&e>5e4?s=7:s=4,console.log("pick court type",e,t,a,r,l,s),{initialScreen:s,screenAfterCourt:c}}const jt=nt(async function(e,t){if(!Rt(e))return null;const a=await Et(e);return a?await at(a,t):null}),At=nt(async function(e,t){return console.log("pickCourtCredentialsAddress",e),await at({kladr:e.kladr_id,city:e.city,street:e.street},t)});async function at(e,t){if(e.kladr.startsWith("77")){const a=await It(e.kladr);return a?{magistrate_code:null,name:`Судебный участок № ${a.index} г. Москвы`,address:a.address,url:`https://mos-sud.ru/${a.index}`,kladr:null}:null}else{const a=await Ot({kladr:e.kladr,city:e.city,street:e.street,greenButton:t});return a?{...a[0],kladr:a[0].kladr[0]??null}:null}}async function Ot(e){return fetch(`https://api.zasudi.com/court-address
		?kladr=${e.kladr}&city=${e.city}&street=${e.street}&green_button=${e.greenButton}`).then(a=>a.json()).catch(a=>(console.error("queryCourtAddressEndpoint error",a),null))}async function It(e){return fetch(`https://bba6s46ltcekm5d04btj.containers.yandexcloud.net/api/${e}`).then(t=>t.json()).catch(t=>(console.error("queryMscCourtEndpoint error",t),null))}async function Et(e){let t=null;try{const a=await fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/findById/party",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Token 64bda6eefd1d370b9b812b6cebce7216af81b24d"},body:JSON.stringify({query:e})}).then(l=>(t=l.status,l)).then(l=>l.json());if(a.suggestions.length===0)return null;const r=a.suggestions[0];return{name:r.data.name.full_with_opf,kladr:r.data.address.data.kladr_id,city:r.data.address.data.city,street:r.data.address.data.street_with_type}}catch(a){return console.error("queryINN error",a.toString(),"status",t),null}}function Rt(e){if(typeof e!="string"||e.length!==10&&e.length!==12||e.split("").some(t=>isNaN(Number(t))))return!1;if(e.length===10)return Number(e[9])===e.split("").slice(0,-1).reduce((t,a,r)=>[2,4,10,3,5,9,4,6,8][r]*Number(a)+t,0)%11%10;if(e.length===12){let t=e.split("").slice(0,-2).reduce((r,l,s)=>[7,2,4,10,3,5,9,4,6,8][s]*Number(l)+r,0)%11%10,a=e.split("").slice(0,-1).reduce((r,l,s)=>[3,7,2,4,10,3,5,9,4,6,8][s]*Number(l)+r,0)%11%10;return t===Number(e[10])&&a===Number(e[11])}return!1}var Yt=re("<div><pre>");const[me,Lt]=De(!1);function Ce(e){let t;return e===2||e===6?t=x(new yt):t=x(new bt),t.type=["arb-claim","arb-simple","arb-order","jp-claim","gen-claim","gen-simple","jp-order"][e],t}function rt(e){return["arb-claim","arb-simple","arb-order","jp-claim","gen-claim","gen-simple","jp-order"].findIndex(t=>t===e.type)}function Se(e){return e.zaemshik.type==="fl"||e.zaimodavec.type==="fl"||e.zaimodavec.type==="ip"&&e.zaimodavec.liquidation!==null||e.zaemshik.type==="ip"&&e.zaemshik.liquidation!==null?"sou":"arb"}function qt(){const[e,t]=$e(),a=(s,c)=>{t("court",s,vt(c))},r=()=>rt(e.court),l=s=>{t("court",Ce(s))};return(()=>{var s=Yt(),c=s.firstChild;return _(s,u(K,{get children(){return[u(ke,{get disabled(){return!me()},items:[{text:"1"},{text:"2"},{text:"3"},{text:"4"},{text:"5"},{text:"6"},{text:"7"}],get value(){return r()},setValue:m=>{function h(y){return y>=0&&y<=6}if(h(m))l(m);else throw new Error("Invalid court screen number")}}),u(Xe,{label:"Выбрать вручную",get value(){return me()},setValue:m=>{console.log(m,me()),Lt(m)}})]}}),c),_(c,()=>JSON.stringify(e.court,null,2)),_(s,u(K,{get children(){return u(pe,{get children(){return[u(M,{get when(){return r()===0},get children(){return u(ae,{get value(){return e.court},setValue:a})}}),u(M,{get when(){return r()===1},get children(){return u(ae,{get value(){return e.court},setValue:a})}}),u(M,{get when(){return r()===2},get children(){return u(Ge,{get value(){return e.court},setValue:a})}}),u(M,{get when(){return r()===3},get children(){return u(ae,{get value(){return e.court},setValue:a})}}),u(M,{get when(){return r()===4},get children(){return u(ae,{get value(){return e.court},setValue:a})}}),u(M,{get when(){return r()===5},get children(){return u(ae,{get value(){return e.court},setValue:a})}}),u(M,{get when(){return r()===6},get children(){return u(Ge,{get value(){return e.court},setValue:a})}})]}})}}),null),s})()}function ae(e){const t=()=>e.value.value,a=(r,l)=>{console.log("setting",x(e.value.value),r,l),e.setValue("value",{...e.value.value,[r]:l})};return u(We,{items:[{label:"Исковое заявление будет подано по месту жительства/нахождения должника (по умолчанию)",value:"default"},{label:"В договоре указан конкретный суд, в котором рассматриваются споры по договору",value:"specific"},{label:"Выбрать суд вручную",value:"manual"},{label:"В договоре укзаано, что дело рассматривается по месту нахождения/жительства истца",value:"zd-venue"},{label:"В договоре указано, что дело рассматривается по месту нахождения/жительства Займодавца",value:"za-venue"}],get value(){return e.value.value.type},setValue:r=>{switch(r){case"default":e.setValue("value",x(new _e));break;case"specific":e.setValue("value",x(new He));break;case"manual":e.setValue("value",x(new xe));break;case"zd-venue":e.setValue("value",x(new Ze));break;case"za-venue":e.setValue("value",x(new Qe));break;default:throw new Error("Invalid court claim value")}},get children(){return u(it,{get value(){return t()},setValue:a})}})}function Ge(e){const t=()=>e.value.value,a=(l,s)=>{e.setValue("value",{...e.value.value,[l]:s})},r=()=>e.value.value.type==="objections"||e.value.value.type==="rejected"||e.value.value.type==="cancelled"?"no-order":"order";return[u(We,{items:[{label:"Обратиться за вынесением судебного приказа",value:"order"},{label:"Я не могу обратиться за вынесением судебного приказа",value:"no-order"}],get value(){return r()},setValue:l=>{l==="order"?e.setValue("value",x(new _e)):e.setValue("value",x(new Ue))}}),u(K,{get children(){return u(pe,{get children(){return[u(M,{get when(){return r()==="order"},get children(){return[u(ke,{tallerRows:!0,items:[{text:"Исковое заявление будет подано по месту жительства/нахождения должника (по умолчанию)",value:"default"},{text:"В договоре указан конкретный суд, в котором рассматриваются споры по договору",value:"specific"},{text:"Выбрать суд вручную",value:"manual"},{text:"В договоре укзаано, что дело рассматривается по месту нахождения/жительства истца",value:"zd-venue"},{text:"В договоре указано, что дело рассматривается по месту нахождения/жительства Займодавца",value:"za-venue"}],get value(){return e.value.value.type},setValue:l=>{switch(l){case"default":e.setValue("value",x(new _e));break;case"specific":e.setValue("value",x(new He));break;case"manual":e.setValue("value",x(new xe));break;case"zd-venue":e.setValue("value",x(new Ze));break;case"za-venue":e.setValue("value",x(new Qe));break;default:throw new Error("Invalid court claim (order) value")}}}),u(it,{get value(){return t()},setValue:a})]}}),u(M,{get when(){return r()==="no-order"},get children(){return[u(ke,{tallerRows:!0,items:[{text:"У меня имеются письменные возражения заёмщика относительно спорной задолженности.",value:"objections"},{text:"Я уже обращался с заявлением о вынесении судебного приказа, однако Арбитражный суд вынес определение об отказе в принятии заявления о вынесении судебного приказа",value:"rejected"},{text:"Я уже обращался с заявлением о вынесении судебного приказа, однако судебный приказ был отменён в связи с подачей возражений должника.",value:"cancelled"}],get value(){return e.value.value.type},setValue:l=>{switch(l){case"objections":e.setValue("value",x(new Ue));break;case"rejected":e.setValue("value",x(new kt));break;case"cancelled":e.setValue("value",x(new Dt));break;default:throw new Error("Invalid court claim (no-order) value")}}}),u(pe,{get children(){return[u(M,{get when(){return e.value.value.type==="objections"},get children(){return[u(I,{label:"Наименование документа",get value(){return e.value.value.date},setValue:l=>a("name",l)}),u(I,{type:"date",label:"Дата документа",get value(){return e.value.value.date},setValue:l=>a("date",l)})]}}),u(M,{get when(){return e.value.value.type==="rejected"},get children(){return[u(I,{type:"date",label:"Дата определения об отказе в принятии заявления о вынесении судебного приказа",get value(){return e.value.value.date},setValue:l=>a("date",l)}),u(I,{label:"Номер дела из картотеки арбитражных дел",get value(){return e.value.value.date},setValue:l=>a("case",l)})]}}),u(M,{get when(){return e.value.value.type==="cancelled"},get children(){return[u(I,{type:"date",label:"Дата определения об отказе в принятии заявления о вынесении судебного приказа",get value(){return e.value.value.date},setValue:l=>a("date",l)}),u(I,{label:"Номер дела из картотеки арбитражных дел",get value(){return e.value.value.date},setValue:l=>a("case",l)})]}})]}})]}})]}})}})]}function it(e){return u(pe,{get children(){return[u(M,{get when(){return e.value.type==="specific"},get children(){return u(K,{get children(){return[u(I,{label:"Наименование суда",get value(){return e.value.name},setValue:t=>e.setValue("name",t)}),u(I,{label:"Пункт договора",get value(){return e.value.clause},setValue:t=>e.setValue("clause",t)})]}})}}),u(M,{get when(){return e.value.type==="manual"},get children(){return u(K,{get children(){return u(I,{label:"Наименование суда",get value(){return e.value.name},setValue:t=>e.setValue("name",t)})}})}}),u(M,{get when(){return e.value.type==="zd-venue"},get children(){return u(K,{get children(){return u(I,{label:"Пункт договора",get value(){return e.value.clause},setValue:t=>e.setValue("clause",t)})}})}}),u(M,{get when(){return e.value.type==="za-venue"},get children(){return u(K,{get children(){return u(I,{label:"Пункт договора",get value(){return e.value.clause},setValue:t=>e.setValue("clause",t)})}})}})]}})}function Bt(e){const[t,a]=$e();return we(gt(()=>e.currentCrumb,async()=>{let r=_t(t.court);if(me()){console.log("court value overriden - not reacting");return}const l=Tt(t);l&&(r=l);const s=rt(r)+1;let c=null;if(t.zaemshik.type==="ul"?c=await jt(t.zaemshik.inn,s):t.zaemshik.resolvedAddress!==null&&(c=await At(t.zaemshik.resolvedAddress,s)),console.log("court name",c,r.type,!r.type.includes("order")),c&&!r.type.includes("order")){r=r;const m=new xe;m.name=c.name,r.value=x(m)}a("court",r)})),null}const tn=Object.freeze(Object.defineProperty({__proto__:null,CourtReactToFlow:Bt,courtType:Se,default:qt,generateCourtFromNumber:Ce},Symbol.toStringTag,{value:"Module"}));export{en as C,tn as a};
